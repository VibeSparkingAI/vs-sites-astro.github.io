<!DOCTYPE html><html lang="zh-CN" dir="ltr" data-theme="dark" data-has-toc data-has-sidebar class="astro-bguv2lll"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>HarmonyOS | Vibe Sparking AI</title><link rel="canonical" href="https://www.vibesparking.com/zh-cn/blog/tags/harmonyos/"/><link rel="alternate" hreflang="en" href="https://www.vibesparking.com/en/blog/tags/harmonyos/"/><link rel="alternate" hreflang="zh-CN" href="https://www.vibesparking.com/zh-cn/blog/tags/harmonyos/"/><link rel="sitemap" href="/sitemap-index.xml"/><script src="https://www.googletagmanager.com/gtag/js?id=G-82Q2L9J1C6" defer></script><script src="/src/ga.js" defer></script><link href="https://www.vibesparking.com/blog/rss.xml" rel="alternate" title="Blog" type="application/rss+xml"/><link rel="shortcut icon" href="/favicon.svg" type="image/svg+xml"/><meta name="generator" content="Astro v5.16.6"/><meta name="generator" content="Starlight v0.34.8"/><meta property="og:title" content="HarmonyOS"/><meta property="og:type" content="article"/><meta property="og:url" content="https://www.vibesparking.com/zh-cn/blog/tags/harmonyos/"/><meta property="og:locale" content="zh-CN"/><meta property="og:description"/><meta property="og:site_name" content="Vibe Sparking AI"/><meta name="twitter:card" content="summary_large_image"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg><svg aria-hidden="true" class="dark astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg><svg aria-hidden="true" class="auto astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg></template><link rel="stylesheet" href="/_astro/print.DNXP8c50.css" media="print"><style>[data-has-toc] :is(.right-sidebar-panel,mobile-starlight-toc){display:none}[data-has-toc] .main-frame{padding-top:var(--sl-nav-height)}.preview:where(.astro-dr56dw7m){display:flex;flex-direction:column;gap:1.5rem}h2:where(.astro-dr56dw7m){margin-bottom:1.5rem}h2:where(.astro-dr56dw7m) a:where(.astro-dr56dw7m){text-decoration:none}.posts:where(.astro-xaz7kpyh){display:flex;flex-direction:column;gap:3rem}
.count:where(.astro-bu4jbvld){font-size:var(--sl-text-xl);font-weight:600}
</style>
<link rel="stylesheet" href="/_astro/Authors.ZOJGGPNO.css">
<style>@layer starlight.components{:root{--sl-badge-default-border: var(--sl-color-accent);--sl-badge-default-bg: var(--sl-color-accent-low);--sl-badge-default-text: #fff;--sl-badge-note-border: var(--sl-color-blue);--sl-badge-note-bg: var(--sl-color-blue-low);--sl-badge-note-text: #fff;--sl-badge-danger-border: var(--sl-color-red);--sl-badge-danger-bg: var(--sl-color-red-low);--sl-badge-danger-text: #fff;--sl-badge-success-border: var(--sl-color-green);--sl-badge-success-bg: var(--sl-color-green-low);--sl-badge-success-text: #fff;--sl-badge-caution-border: var(--sl-color-orange);--sl-badge-caution-bg: var(--sl-color-orange-low);--sl-badge-caution-text: #fff;--sl-badge-tip-border: var(--sl-color-purple);--sl-badge-tip-bg: var(--sl-color-purple-low);--sl-badge-tip-text: #fff}[data-theme=light]:root{--sl-badge-default-bg: var(--sl-color-accent-high);--sl-badge-note-bg: var(--sl-color-blue-high);--sl-badge-danger-bg: var(--sl-color-red-high);--sl-badge-success-bg: var(--sl-color-green-high);--sl-badge-caution-bg: var(--sl-color-orange-high);--sl-badge-tip-bg: var(--sl-color-purple-high)}.sl-badge:where(.astro-avdet4wd){display:inline-block;border:1px solid var(--sl-color-border-badge);border-radius:.25rem;font-family:var(--sl-font-system-mono);line-height:normal;color:var(--sl-color-text-badge);background-color:var(--sl-color-bg-badge);overflow-wrap:anywhere}.sidebar-content .sl-badge:where(.astro-avdet4wd){line-height:1;font-size:var(--sl-text-xs);padding:.125rem .375rem}.sidebar-content a[aria-current=page]>.sl-badge:where(.astro-avdet4wd){--sl-color-bg-badge: transparent;--sl-color-border-badge: currentColor;color:inherit}.default:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-default-bg);--sl-color-border-badge: var(--sl-badge-default-border);--sl-color-text-badge: var(--sl-badge-default-text)}.note:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-note-bg);--sl-color-border-badge: var(--sl-badge-note-border);--sl-color-text-badge: var(--sl-badge-note-text)}.danger:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-danger-bg);--sl-color-border-badge: var(--sl-badge-danger-border);--sl-color-text-badge: var(--sl-badge-danger-text)}.success:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-success-bg);--sl-color-border-badge: var(--sl-badge-success-border);--sl-color-text-badge: var(--sl-badge-success-text)}.tip:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-tip-bg);--sl-color-border-badge: var(--sl-badge-tip-border);--sl-color-text-badge: var(--sl-badge-tip-text)}.caution:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-caution-bg);--sl-color-border-badge: var(--sl-badge-caution-border);--sl-color-text-badge: var(--sl-badge-caution-text)}.small:where(.astro-avdet4wd){font-size:var(--sl-text-xs);padding:.125rem .25rem}.medium:where(.astro-avdet4wd){font-size:var(--sl-text-sm);padding:.175rem .35rem}.large:where(.astro-avdet4wd){font-size:var(--sl-text-base);padding:.225rem .45rem}.sl-markdown-content :is(h1,h2,h3,h4,h5,h6) .sl-badge:where(.astro-avdet4wd){vertical-align:middle}}
@layer starlight.components{.card-grid:where(.astro-zntqmydn){display:grid;grid-template-columns:100%;gap:1rem}.card-grid:where(.astro-zntqmydn)>*{margin-top:0!important}@media (min-width: 50rem){.card-grid:where(.astro-zntqmydn){grid-template-columns:1fr 1fr;gap:1.5rem}.stagger:where(.astro-zntqmydn){--stagger-height: 5rem;padding-bottom:var(--stagger-height)}.stagger:where(.astro-zntqmydn)>*:nth-child(2n){transform:translateY(var(--stagger-height))}}}
@layer starlight.components{.card:where(.astro-v5tidmuc){--sl-card-border: var(--sl-color-purple);--sl-card-bg: var(--sl-color-purple-low);border:1px solid var(--sl-color-gray-5);background-color:var(--sl-color-black);padding:clamp(1rem,calc(.125rem + 3vw),2.5rem);flex-direction:column;gap:clamp(.5rem,calc(.125rem + 1vw),1rem)}.card:where(.astro-v5tidmuc):nth-child(4n+1){--sl-card-border: var(--sl-color-orange);--sl-card-bg: var(--sl-color-orange-low)}.card:where(.astro-v5tidmuc):nth-child(4n+3){--sl-card-border: var(--sl-color-green);--sl-card-bg: var(--sl-color-green-low)}.card:where(.astro-v5tidmuc):nth-child(4n+4){--sl-card-border: var(--sl-color-red);--sl-card-bg: var(--sl-color-red-low)}.card:where(.astro-v5tidmuc):nth-child(4n+5){--sl-card-border: var(--sl-color-blue);--sl-card-bg: var(--sl-color-blue-low)}.title:where(.astro-v5tidmuc){font-weight:600;font-size:var(--sl-text-h4);color:var(--sl-color-white);line-height:var(--sl-line-height-headings);gap:1rem;align-items:center}.card:where(.astro-v5tidmuc) .icon:where(.astro-v5tidmuc){border:1px solid var(--sl-card-border);background-color:var(--sl-card-bg);padding:.2em;border-radius:.25rem;flex-shrink:0}.card:where(.astro-v5tidmuc) .body:where(.astro-v5tidmuc){margin:0;font-size:clamp(var(--sl-text-sm),calc(.5rem + 1vw),var(--sl-text-body))}}
@layer starlight.components{svg:where(.astro-c6vsoqas){color:var(--sl-icon-color);font-size:var(--sl-icon-size, 1em);width:1em;height:1em}}
@layer starlight.components{.sl-link-card:where(.astro-mf7fz2mj){display:grid;grid-template-columns:1fr auto;gap:.5rem;border:1px solid var(--sl-color-gray-5);border-radius:.5rem;padding:1rem;box-shadow:var(--sl-shadow-sm);position:relative}a:where(.astro-mf7fz2mj){text-decoration:none;line-height:var(--sl-line-height-headings)}a:where(.astro-mf7fz2mj):before{content:"";position:absolute;inset:0}.stack:where(.astro-mf7fz2mj){flex-direction:column;gap:.5rem}.title:where(.astro-mf7fz2mj){color:var(--sl-color-white);font-weight:600;font-size:var(--sl-text-lg)}.description:where(.astro-mf7fz2mj){color:var(--sl-color-gray-3);line-height:1.5}.icon:where(.astro-mf7fz2mj){color:var(--sl-color-gray-3)}.sl-link-card:where(.astro-mf7fz2mj):hover{background:var(--sl-color-gray-7, var(--sl-color-gray-6));border-color:var(--sl-color-gray-2)}.sl-link-card:where(.astro-mf7fz2mj):hover .icon:where(.astro-mf7fz2mj){color:var(--sl-color-white)}}
@layer starlight.components{.sl-steps{--bullet-size: calc(var(--sl-line-height) * 1rem);--bullet-margin: .375rem;list-style:none;counter-reset:steps-counter var(--sl-steps-start, 0);padding-inline-start:0}.sl-steps>li{counter-increment:steps-counter;position:relative;padding-inline-start:calc(var(--bullet-size) + 1rem);padding-bottom:1px;min-height:calc(var(--bullet-size) + var(--bullet-margin))}.sl-steps>li+li{margin-top:0}.sl-steps>li:before{content:counter(steps-counter);position:absolute;top:0;inset-inline-start:0;width:var(--bullet-size);height:var(--bullet-size);line-height:var(--bullet-size);font-size:var(--sl-text-xs);font-weight:600;text-align:center;color:var(--sl-color-white);background-color:var(--sl-color-gray-6);border-radius:99rem;box-shadow:inset 0 0 0 1px var(--sl-color-gray-5)}.sl-steps>li:after{--guide-width: 1px;content:"";position:absolute;top:calc(var(--bullet-size) + var(--bullet-margin));bottom:var(--bullet-margin);inset-inline-start:calc((var(--bullet-size) - var(--guide-width)) / 2);width:var(--guide-width);background-color:var(--sl-color-hairline-light)}}@layer starlight.content{.sl-steps>li>:first-child{--lh: calc(1em * var(--sl-line-height));--shift-y: calc(.5 * (var(--bullet-size) - var(--lh)));transform:translateY(var(--shift-y));margin-bottom:var(--shift-y)}.sl-steps>li>:first-child:where(h1,h2,h3,h4,h5,h6){--lh: calc(1em * var(--sl-line-height-headings))}@supports (--prop: 1lh){.sl-steps>li>:first-child{--lh: 1lh}}}
@layer starlight.components{.sl-link-button:where(.astro-xwgiixxa){align-items:center;border:1px solid transparent;border-radius:999rem;display:inline-flex;font-size:var(--sl-text-sm);gap:.5em;line-height:1.1875;outline-offset:.25rem;padding:.4375rem 1.125rem;text-decoration:none}.sl-link-button:where(.astro-xwgiixxa).primary{background:var(--sl-color-text-accent);border-color:var(--sl-color-text-accent);color:var(--sl-color-black)}.sl-link-button:where(.astro-xwgiixxa).primary:hover{color:var(--sl-color-black)}.sl-link-button:where(.astro-xwgiixxa).secondary{border-color:inherit;color:var(--sl-color-white)}.sl-link-button:where(.astro-xwgiixxa).minimal{color:var(--sl-color-white);padding-inline:0}.sl-link-button:where(.astro-xwgiixxa) svg{flex-shrink:0}@media (min-width: 50rem){.sl-link-button:where(.astro-xwgiixxa){font-size:var(--sl-text-base);padding:.9375rem 1.25rem}}.sl-markdown-content .sl-link-button:where(.astro-xwgiixxa){margin-inline-end:1rem}.sl-markdown-content .sl-link-button:where(.astro-xwgiixxa):not(:where(p *)){margin-block:1rem}}
</style><script type="module" src="/_astro/page.DoZOnLmF.js"></script></head> <body class="astro-bguv2lll"> <a href="#_top" class="astro-7q3lir66">跳转到内容</a>  <div class="page sl-flex astro-vrdttmbt"> <header class="header astro-vrdttmbt"><div class="header astro-kmkmnagf"> <div class="title-wrapper sl-flex astro-kmkmnagf"> <a href="/zh-cn" class="site-title sl-flex astro-m46x6ez3">  <span class="astro-m46x6ez3" translate="no"> Vibe Sparking AI </span> </a>  </div> <div class="sl-flex print:hidden astro-kmkmnagf"> <site-search class="astro-kmkmnagf astro-v37mnknz" data-translations="{&#34;placeholder&#34;:&#34;搜索&#34;}"> <button data-open-modal disabled aria-label="搜索" aria-keyshortcuts="Control+K" class="astro-v37mnknz"> <svg aria-hidden="true" class="astro-v37mnknz astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg> <span class="sl-hidden md:sl-block astro-v37mnknz" aria-hidden="true">搜索</span> <kbd class="sl-hidden md:sl-flex astro-v37mnknz" style="display: none;"> <kbd class="astro-v37mnknz">Ctrl</kbd><kbd class="astro-v37mnknz">K</kbd> </kbd> </button> <dialog style="padding:0" aria-label="搜索" class="astro-v37mnknz"> <div class="dialog-frame sl-flex astro-v37mnknz">  <button data-close-modal class="sl-flex md:sl-hidden astro-v37mnknz"> 取消 </button> <div class="search-container astro-v37mnknz"> <div id="starlight__search" class="astro-v37mnknz"></div> </div> </div> </dialog> </site-search>  <script>
	(() => {
		const openBtn = document.querySelector('button[data-open-modal]');
		const shortcut = openBtn?.querySelector('kbd');
		if (!openBtn || !(shortcut instanceof HTMLElement)) return;
		const platformKey = shortcut.querySelector('kbd');
		if (platformKey && /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)) {
			platformKey.textContent = '⌘';
			openBtn.setAttribute('aria-keyshortcuts', 'Meta+K');
		}
		shortcut.style.display = '';
	})();
</script> <script type="module" src="/_astro/Search.astro_astro_type_script_index_0_lang.DMZ5WJ-J.js"></script>   </div> <div class="sl-hidden md:sl-flex print:hidden right-group astro-kmkmnagf"> <div class="sl-flex social-icons astro-kmkmnagf"> <nav aria-label="Navbar" class="astro-7ecetekw"> <ul class="main-nav astro-7ecetekw"> <li class="has-dropdown astro-7ecetekw"> <a href="awesome" class="astro-7ecetekw">推荐</a> <ul class="dropdown-menu astro-7ecetekw"> <li class=" astro-7ecetekw"> <a href="https://awesome-tools.vibesparking.com/" class="astro-7ecetekw">推荐 工具</a>  </li> </ul> </li><li class="has-dropdown astro-7ecetekw"> <a href="products" class="astro-7ecetekw">产品</a> <ul class="dropdown-menu astro-7ecetekw"> <li class=" astro-7ecetekw"> <a href="https://ingest2ai.vibesparking.com/" class="astro-7ecetekw">Ingest2AI</a>  </li> </ul> </li><li class="has-dropdown astro-7ecetekw"> <a href="wellness" class="astro-7ecetekw">健康</a> <ul class="dropdown-menu astro-7ecetekw"> <li class=" astro-7ecetekw"> <a href="wellness/sleep" class="astro-7ecetekw">睡眠</a>  </li><li class=" astro-7ecetekw"> <a href="wellness/fitness" class="astro-7ecetekw">健身</a>  </li><li class=" astro-7ecetekw"> <a href="wellness/relaxation" class="astro-7ecetekw">放松</a>  </li> </ul> </li><li class=" astro-7ecetekw"> <a href="wealth" class="astro-7ecetekw">财富</a>  </li><li class="has-dropdown astro-7ecetekw"> <a href="growth" class="astro-7ecetekw">成长</a> <ul class="dropdown-menu astro-7ecetekw"> <li class=" astro-7ecetekw"> <a href="ai/vibe-coding" class="astro-7ecetekw">AI 灵感编程</a>  </li> </ul> </li> </ul> </nav>  <script type="module">document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".main-nav > li > a, .dropdown-menu > li > a").forEach(e=>{e.addEventListener("click",t=>{if(window.innerWidth<=768){const n=e.parentElement;n&&(n.classList.contains("has-dropdown")||n.classList.contains("has-submenu"))&&(t.preventDefault(),n.classList.toggle("active"))}})})});</script> <a href="https://github.com/VibeSparkingAI/vs-sites-astro.github.io" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg></a><a href="https://www.vibesparking.com/blog/rss.xml" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">RSS</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M2.88 16.88a3 3 0 0 0 0 4.24 3 3 0 0 0 4.24 0 3 3 0 0 0-4.24-4.24Zm2.83 2.83a1 1 0 0 1-1.42-1.42 1 1 0 0 1 1.42 0 1 1 0 0 1 0 1.42ZM5 12a1 1 0 0 0 0 2 5 5 0 0 1 5 5 1 1 0 0 0 2 0 7 7 0 0 0-7-7Zm0-4a1 1 0 0 0 0 2 9 9 0 0 1 9 9 1 1 0 0 0 2 0 11.08 11.08 0 0 0-3.22-7.78A11.08 11.08 0 0 0 5 8Zm10.61.39A15.11 15.11 0 0 0 5 4a1 1 0 0 0 0 2 13 13 0 0 1 13 13 1 1 0 0 0 2 0 15.11 15.11 0 0 0-4.39-10.61Z"/></svg></a> </div> <div class="astro-eboeziq4"> <a href="/zh-cn/blog/" class="astro-eboeziq4">Blog</a> </div>  <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">选择主题</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> <select value="auto" autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">深色</option><option value="light" class="astro-4yphtoen">浅色</option><option value="auto" selected class="astro-4yphtoen">自动</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script> <script type="module">const r="starlight-theme",o=e=>e==="auto"||e==="dark"||e==="light"?e:"auto",c=()=>o(typeof localStorage<"u"&&localStorage.getItem(r));function n(e){typeof localStorage<"u"&&localStorage.setItem(r,e==="light"||e==="dark"?e:"")}const l=()=>matchMedia("(prefers-color-scheme: light)").matches?"light":"dark";function t(e){StarlightThemeProvider.updatePickers(e),document.documentElement.dataset.theme=e==="auto"?l():e,n(e)}matchMedia("(prefers-color-scheme: light)").addEventListener("change",()=>{c()==="auto"&&t("auto")});class s extends HTMLElement{constructor(){super(),t(c()),this.querySelector("select")?.addEventListener("change",a=>{a.currentTarget instanceof HTMLSelectElement&&t(o(a.currentTarget.value))})}}customElements.define("starlight-theme-select",s);</script> <starlight-lang-select><label style="--sl-select-width: 7em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">选择语言</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path fill-rule="evenodd" d="M8.516 3a.94.94 0 0 0-.941.94v1.15H2.94a.94.94 0 1 0 0 1.882h7.362a7.422 7.422 0 0 1-1.787 3.958 7.42 7.42 0 0 1-1.422-2.425.94.94 0 1 0-1.774.627 9.303 9.303 0 0 0 1.785 3.043 7.422 7.422 0 0 1-4.164 1.278.94.94 0 1 0 0 1.881 9.303 9.303 0 0 0 5.575-1.855 9.303 9.303 0 0 0 4.11 1.74l-.763 1.525a.968.968 0 0 0-.016.034l-1.385 2.77a.94.94 0 1 0 1.683.841l1.133-2.267h5.806l1.134 2.267a.94.94 0 0 0 1.683-.841l-1.385-2.769a.95.95 0 0 0-.018-.036l-3.476-6.951a.94.94 0 0 0-1.682 0l-1.82 3.639a7.423 7.423 0 0 1-3.593-1.256 9.303 9.303 0 0 0 2.27-5.203h1.894a.94.94 0 0 0 0-1.881H9.456V3.94A.94.94 0 0 0 8.516 3Zm6.426 11.794a1.068 1.068 0 0 1-.02.039l-.703 1.407h3.924l-1.962-3.924-1.24 2.478Z" clip-rule="evenodd"/></svg> <select value="/zh-cn/blog/tags/harmonyos/" autocomplete="off" class="astro-4yphtoen"> <option value="/en/blog/tags/harmonyos/" class="astro-4yphtoen">English</option><option value="/zh-cn/blog/tags/harmonyos/" selected class="astro-4yphtoen">简体中文</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label> </starlight-lang-select><script type="module">class s extends HTMLElement{constructor(){super();const e=this.querySelector("select");e&&(e.addEventListener("change",t=>{t.currentTarget instanceof HTMLSelectElement&&(window.location.pathname=t.currentTarget.value)}),window.addEventListener("pageshow",t=>{if(!t.persisted)return;const n=e.querySelector("option[selected]")?.index;n!==e.selectedIndex&&(e.selectedIndex=n??0)}))}}customElements.define("starlight-lang-select",s);</script> </div> </div> </header> <nav class="sidebar print:hidden astro-vrdttmbt" aria-label="主要"> <starlight-menu-button class="print:hidden astro-jif73yzw"> <button aria-expanded="false" aria-label="菜单" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-jif73yzw"> <svg aria-hidden="true" class="open-menu astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg> <svg aria-hidden="true" class="close-menu astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="m13.41 12 6.3-6.29a1.004 1.004 0 1 0-1.42-1.42L12 10.59l-6.29-6.3a1.004 1.004 0 0 0-1.42 1.42l6.3 6.29-6.3 6.29a1 1 0 0 0 0 1.42.998.998 0 0 0 1.42 0l6.29-6.3 6.29 6.3a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.42L13.41 12Z"/></svg> </button> </starlight-menu-button> <script type="module">class s extends HTMLElement{constructor(){super(),this.btn=this.querySelector("button"),this.btn.addEventListener("click",()=>this.toggleExpanded());const t=this.closest("nav");t&&t.addEventListener("keyup",e=>this.closeOnEscape(e))}setExpanded(t){this.setAttribute("aria-expanded",String(t)),document.body.toggleAttribute("data-mobile-menu-expanded",t)}toggleExpanded(){this.setExpanded(this.getAttribute("aria-expanded")!=="true")}closeOnEscape(t){t.code==="Escape"&&(this.setExpanded(!1),this.btn.focus())}}customElements.define("starlight-menu-button",s);</script>   <div id="starlight__sidebar" class="sidebar-pane astro-vrdttmbt"> <div class="sidebar-content sl-flex astro-vrdttmbt"> <sl-sidebar-state-persist data-hash="0ewwy6k" class="astro-kku4brbg"> <script aria-hidden="true">
		(() => {
			try {
				if (!matchMedia('(min-width: 50em)').matches) return;
				/** @type {HTMLElement | null} */
				const target = document.querySelector('sl-sidebar-state-persist');
				const state = JSON.parse(sessionStorage.getItem('sl-sidebar-state') || '0');
				if (!target || !state || target.dataset.hash !== state.hash) return;
				window._starlightScrollRestore = state.scroll;
				customElements.define(
					'sl-sidebar-restore',
					class SidebarRestore extends HTMLElement {
						connectedCallback() {
							try {
								const idx = parseInt(this.dataset.index || '');
								const details = this.closest('details');
								if (details && typeof state.open[idx] === 'boolean') details.open = state.open[idx];
							} catch {}
						}
					}
				);
			} catch {}
		})();
	</script>  <ul class="top-level astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/zh-cn/blog/" aria-current="false" class="large astro-3ii7xxms"> <span class="astro-3ii7xxms">All posts</span>  </a> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <sl-sidebar-restore data-index="0"></sl-sidebar-restore> <summary class="astro-3ii7xxms"> <div class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Recent posts</span>  </div> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/zh-cn/blog/journals/2025-12-17/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">日报 - 2025-12-17 Accenture and Anthropic partnership</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/ai/bmad/2025-12-15-bmad-v6-installation-modular-agentvibes/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">BMAD v6 安装更新：模块化 + AgentVibes “会说话”的开发体验</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/ai/google/antigravity/practices/2025-12-11-breaking-the-no-repro-challenge-antigravity-precise-bug-locating-through-code-reasoning/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">破局“无设备复现”难题：Antigravity 如何通过代码推理精准定位复杂 Bug</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/ai/google/antigravity/practices/2025-12-11-google-antigravity-ai-assisted-debugging-case-study/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">没有用户手机也能修 Bug：Antigravity 自主调试的实战案例</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/ai/google/antigravity/practices/2025-12-11-google-antigravity-from-screenshot-to-code-fix-agentic-workflow/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">解密 Antigravity：从截图到代码修复的 Agentic 工作流</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/ai/google/antigravity/practices/2025-12-10-google-antigravity-mcp-troubleshooting/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">告别繁琐调试：用 Antigravity + MCP 实现智能化问题排查</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/ai/anthropic/2025-12-09-anthropic-legal-claude-stop-manual-redlining/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Anthropic 法务把审合同这件苦差事，用 Claude 玩成了“工作流艺术”</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/finance/china/2025-12-09-china-ai-supply-chain-outlook-2026/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">中国人工智能：2026年供应链上行空间成为焦点</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/ai/claude-code/claude-mem/2025-12-09-claude-mem-long-term-memory/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">给 Claude 装上「长期记忆」：claude-mem 实战体验与使用建议</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/finance/us-market/2025-12-07-decoding-the-ai-chip-wars-why-google-tpu-wont-kill-nvidia/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">12月～明年1月，美股投资者必须盯紧的几件大事</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/ai/google/antigravity/2025-12-05-google-antigravity-one-click-ui-and-image-generation-in-ide/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Google Antigravity 会写代码也会画图：IDE 里一键生成 UI 和配图</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/ai/google/play/2025-12-05-google-developer-account-application-guide/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">2025保姆级教程：手把手教你申请Google开发者账号（含邓白氏/支付攻略）</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/ai/anthropic/2025-12-03-anthropic-internal-ai-development-survey/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Anthropic 内部员工 AI 开发调查：前端最香，架构最难交给 AI</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/ai/trends/2025-12-02-full-stack-of-agentic-ai/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">从前端到监控，这就是一套可落地的 Agentic AI 工程地图</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/ai/trends/2025-12-01-johari-window-ai-human-dialogue/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">乔哈里视窗模型与人类–AI对话的四象限分析</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/finance/us-market/2025-12-01-december-january-us-stock-investors-must-watch-events/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">12月～明年1月，美股投资者必须盯紧的几件大事</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/ai/google/gemini/nano-banana-pro/2025-12-01-no-ps-needed-gemini-3-one-click-professional-us-stock-financial-calendar-guide-with-tutorial/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">无需PS！教你用 Gemini 3 一键生成专业级美股财经日历（附实战教程）</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/finance/us-market/2025-10-31-ai-us-stock-market-key-events-investment-research-report/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">AI美股11月关键事件投资研究报告</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/finance/us-market/2025-10-30-tech-giants-q3-earnings-investment-advice-ai-opportunities-risks/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">科技巨头Q3财报现状与投资建议：AI驱动下的机遇与风险</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/ai/practices/2025-10-28-from-exploration-to-fix-how-claude-code-thinks-and-reasons-through-a-sqlalchemy-transaction-rollback-issue/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">从探索到修复：Claude Code 如何思考与推理，排查 SQLAlchemy 事务回滚问题</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <sl-sidebar-restore data-index="1"></sl-sidebar-restore> <summary class="astro-3ii7xxms"> <div class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Tags</span>  </div> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </summary> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/claude-code/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Claude Code (93)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ai/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">AI (41)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/finance/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Finance (27)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/openai/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">OpenAI (21)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/anthropic/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Anthropic (19)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ai-agent/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">AI Agent (18)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/cursor/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Cursor (18)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/vibe-coding/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Vibe Coding (15)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/claude/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Claude (11)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/investment/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Investment (11)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/us-market/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">US Market (11)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/chatgpt/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">ChatGPT (10)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/nvidia/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">NVIDIA (10)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ai-era/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">AI Era (9)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/gpt-5/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">GPT-5 (8)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/us-stock-market/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">US Stock Market (8)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/vs-code/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">VS Code (8)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/codex/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Codex (7)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/github-copilot/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">GitHub Copilot (7)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/prompt-engineering/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Prompt Engineering (7)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/gemini/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Gemini (6)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ble/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">BLE (5)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/google-antigravity/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Google Antigravity (5)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/kiro/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Kiro (5)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/palantir/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Palantir (5)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/tesla/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Tesla (5)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/android/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Android (4)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/arkts/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">ArkTS (4)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/bluetooth-low-energy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Bluetooth Low Energy (4)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/earnings/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Earnings (4)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/flutter/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Flutter (4)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/gemini-cli/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Gemini CLI (4)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/google/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Google (4)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/harmonyos/" aria-current="page" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">HarmonyOS (4)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ios/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">iOS (4)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/kimi-k2/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Kimi K2 (4)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/lovable/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Lovable (4)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/nasdaq-nvda/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">NASDAQ: NVDA (4)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/software-engineering/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Software Engineering (4)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/team-management/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Team Management (4)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/vibe-coding-practices/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Vibe Coding Practices (4)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/amazon/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Amazon (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/apk/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">APK (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/bmad/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">BMAD (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/codex-cli/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Codex CLI (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/cursor-agent/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Cursor Agent (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/deepseek/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">DeepSeek (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/figma/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Figma (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/git-worktree/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Git Worktree (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/google-gemini/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Google Gemini (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/jpmorgan/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">JPMorgan (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/mcp/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">MCP (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/meta/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Meta (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/microsoft/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Microsoft (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/mongodb/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">MongoDB (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/nyse-pltr/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">NYSE: PLTR (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/python/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Python (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/robinhood/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Robinhood (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/sp-500/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">S&amp;P 500 (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/tmux/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Tmux (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/trae/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Trae (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/zed/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Zed (3)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/agent-client-protocolacp/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Agent Client Protocol（ACP） (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/aws/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">AWS (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/axon/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Axon (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/blackrock/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">BlackRock (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/citi/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Citi (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/claude-code-ui/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Claude Code UI (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/claude-relay-service/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Claude Relay Service (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/cloud-computing/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Cloud Computing (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/code-review/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Code Review (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/commit-message/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Commit Message (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/conductor/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Conductor (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/copilot/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Copilot (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/education/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Education (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/federal-reserve/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Federal Reserve (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/glm-45/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">GLM-4.5 (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/goldman-sachs/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Goldman Sachs (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/gpu/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">GPU (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ionq/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">IonQ (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/jetbrains/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">JetBrains (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ki2api/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Ki2API (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/n8n/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">n8n (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/nano-banana-pro/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Nano Banana Pro (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/nasdaq/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Nasdaq (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ollama/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Ollama (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/openspec/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">OpenSpec (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/quant/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Quant (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/rails/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Rails (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/rocket-lab/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Rocket Lab (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/rspec/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Rspec (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/snowflake/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Snowflake (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/sofi/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">SoFi (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/spokenly/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Spokenly (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/story-book/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Story Book (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/testing/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Testing (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/thinking/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Thinking (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/v0/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">V0 (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/vibetunnel/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">VibeTunnel (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/wells-fargo/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Wells Fargo (2)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/accenture/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Accenture (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/agentic-ai/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Agentic AI (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/agentic-ide/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Agentic IDE (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ai-infrastructure/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">AI Infrastructure (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ai-model/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">AI Model (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ai-supply-chain/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">AI Supply Chain (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/aider/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Aider (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/amd/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">AMD (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/amp/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Amp (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/android-studio/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Android Studio (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/androidstudio/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Android Studio (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/apple/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Apple (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/apple-礼品卡/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Apple 礼品卡 (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/asml/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">ASML (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/astera-labs/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Astera Labs (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/avalanche-card/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Avalanche Card (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/backlogmd/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Backlog.md (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/bdd/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">BDD (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/beautifulsoup/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">BeautifulSoup (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/behavior-driven-development/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Behavior-Driven Development (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/bluetooth/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Bluetooth (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/boj/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">BOJ (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/bolt/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Bolt (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/boltnew/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Bolt.new (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/browser-echo/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Browser Echo (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/cc-switch/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">cc-switch (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ccpm/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">ccpm (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ccr/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">ccr (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ccstatusline/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">ccstatusline (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ccusage/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">ccusage (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/chain-of-thought-cot/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Chain of Thought (CoT) (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/chatgpt-agent/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">ChatGPT Agent (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/chatgpt-pro/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">ChatGPT Pro (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/chatlog/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">chatlog (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/china/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">China (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/chiphuyen/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Chip Huyen (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/claude-artifacts/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Claude Artifacts (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/claude-code-hooks/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Claude Code Hooks (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/claudecoderouter/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Claude Code Router (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/claude-code-subagents/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Claude Code Subagents (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/claude-max/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Claude Max (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/claude-opus-41/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Claude Opus 4.1 (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/claude-code-companion/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">claude-code-companion (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/claude-code-proxy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">claude-code-proxy (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/claude-code-templates/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">claude-code-templates (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/claude-trace/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">claude-trace (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/cloudflare/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Cloudflare (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/codecombat/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">CodeCombat (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/codegpt/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">CodeGPT (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/command-line-interface-cli/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Command Line Interface (CLI) (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/context-engineering/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Context Engineering (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/context7/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Context7 (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/coreweave/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">CoreWeave (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/coze/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Coze (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/crowdstrike/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">CrowdStrike (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/crush/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Crush (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/cursor-cli/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Cursor CLI (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/d-wave/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">D-Wave (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/dataset/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Dataset (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ddd/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">DDD (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/deepagents/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">DeepAgents (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/deepseek-r1/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">DeepSeek R1 (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/deepseek-v31/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">DeepSeek v3.1 (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/deepwiki/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">DeepWiki (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/designer/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Designer (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/dify/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Dify (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/dlocal/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">DLocal (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/docker/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Docker (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/docker-compose/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Docker Compose (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/documentation/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Documentation (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/documentation-oriented-programming/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Documentation-oriented Programming (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/donald-trump/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Donald Trump (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/doocumentation-driven-development/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Doocumentation-Driven Development (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/dop/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">DoP (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/dxy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">DXY (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/dyad/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Dyad (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ears/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">EARS (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/economic-events/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Economic Events (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/elon-musk/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Elon Musk (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/energy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Energy (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/english/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">English (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/exa/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Exa (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/excel/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Excel (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/export/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">export (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/faang/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">FAANG (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/figma-make/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Figma Make (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/flavor/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Flavor (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/gemini-3/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Gemini 3 (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/gemini-3-pro/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Gemini 3 Pro (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/gemini-cli-companion/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Gemini CLI Companion (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/gemini-ultra/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Gemini Ultra (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/gemini-25-pro/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">gemini-2.5-pro (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/genie-3/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Genie 3 (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/git/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Git (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/git-merge/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">git merge (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/github/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">GitHub (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/github-actions/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">GitHub Actions (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/google-cloud/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Google Cloud (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/google-deepmind/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Google DeepMind (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/google-gemini-cli/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Google Gemini CLI (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/google-opal/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Google Opal (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/google-play/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Google Play (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/google-tpu/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Google TPU (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/google-translate/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Google Translate (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/gpt-oss/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">GPT-OSS (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/grab/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Grab (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/grok/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Grok (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/grok-cli/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Grok CLI (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/html/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">HTML (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ibm/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">IBM (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/icloud/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">iCloud (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ifast-global-bank-card/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">iFAST Global Bank Card (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/iflow-cli/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">iflow-cli (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/index-funds/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Index Funds (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/intc/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">INTC (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/intel/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Intel (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/internet-era/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Internet Era (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ipo/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">IPO (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/iren/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Iren (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/iris-energy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Iris Energy (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/japan/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Japan (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/javascript/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">JavaScript (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/johari-window/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Johari Window (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/kimi-cli/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">kimi-cli (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/kombai/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Kombai (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/kronos/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Kronos (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/landingai/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">LandingAI (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/lottery-ticket-hypothesis/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Lottery Ticket Hypothesis (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/macos/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">macOS (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/magic/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Magic (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/markdown/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Markdown (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/mcp-proxy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">mcp-proxy (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/microsoft-azure/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Microsoft Azure (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/midest/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Midest (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/midjourney/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Midjourney (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/minerals/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Minerals (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/monetary-policy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Monetary Policy (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/moonshot/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Moonshot (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/morgan-stanley/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Morgan Stanley (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/morph/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Morph (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/most-valuable-documentation/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Most Valuable Documentation (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/mp-materials/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">MP Materials (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/mvd/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">MVD (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/nasdaq-100/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Nasdaq 100 (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/nasdaq-tsla/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">NASDAQ: TSLA (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/nebius/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Nebius (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/nebius-ai/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Nebius AI (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/nubank/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Nubank (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/nuclear-energy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Nuclear Energy (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/nyse-fig/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">NYSE: FIG (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/nyse-snow/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">NYSE: SNOW (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/oklo/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Oklo (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/omnara/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Omnara (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/open-lovable/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Open Lovable (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/open-web-search/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Open-Web-Search (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/openai-codex-cli/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">OpenAI Codex CLI (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/openai-compatible-api/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">OpenAI Compatible API (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/openai-o3/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">OpenAI o3 (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/opendoor/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Opendoor (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/openrouter/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">OpenRouter (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/oracle/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Oracle (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/pdf/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">PDF (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/planning/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Planning (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/playwright/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Playwright (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ponyai/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Pony.ai (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/primary-school/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Primary School (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/product-management/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Product Management (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/product-manager/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Product Manager (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/prototype/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Prototype (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/pydantic/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Pydantic (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/quantum-computing/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Quantum Computing (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/rare-earths/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Rare Earths (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/raytheon-technologies/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Raytheon Technologies (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/react/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">React (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/replit-agent/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Replit Agent (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/screen/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Screen (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/security-review/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">security-review (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/semiconductor/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Semiconductor (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/sequential-thinking/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Sequential-Thinking (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/serena/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Serena (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/settingsjson/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">settings.json (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/shopify/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Shopify (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/siliconflow/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">SiliconFlow (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/slack/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Slack (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/sniffly/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Sniffly (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/software-engineer/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Software Engineer (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/spec-driven-development/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Spec-Driven Development (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/spec-kit/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Spec-Kit (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/spec-workflow/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Spec-Workflow (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/spire-global/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Spire Global (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/sqlalchemy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">SQLAlchemy (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/stagewise/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">StageWise (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/station/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Station (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/supergrok-heavy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">SuperGrok Heavy (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/symbotic/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Symbotic (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/synthetic-questions-generation/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Synthetic Questions Generation (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/tamagotchi/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Tamagotchi (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/tap4aiwebui/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">tap4‑ai‑webui (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/telegram/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Telegram (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/terminal/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Terminal (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/terminalcp/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">terminalcp (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/todo-list/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Todo List (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/trae-cn/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Trae CN (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/transaction/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Transaction (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/transmedics/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">TransMedics (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/trump-tariffs/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Trump Tariffs (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/tsmc/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">TSMC (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/typescript/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">TypeScript (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/us-dollar/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">US Dollar (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/us-treasuries/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">US Treasuries (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/usd-index/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">USD Index (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/usdjpy/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">USDJPY (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/ux/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">UX (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/uzi/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">uzi (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/veo/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Veo (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/vgt/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">VGT (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/vibe-kanban/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">vibe-kanban (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/vibetree/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">VibeTree (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/vscode/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">VSCode (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/warp/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Warp (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/web/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Web (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/windsurf/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Windsurf (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/word/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Word (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/zcf---ai-agent---claude-code/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">zcf - AI Agent - Claude Code (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/zelda/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Zelda (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/zelda-claude-code/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">zelda-claude-code (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/尼日利亚/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">尼日利亚 (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/微信/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">微信 (1)</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/tags/雪崩卡/" aria-current="false" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">雪崩卡 (1)</span>  </a> </li> </ul>  </details> </li><li class="astro-3ii7xxms"> <a href="/zh-cn/blog/rss.xml" aria-current="false" class="large astro-3ii7xxms"> <span class="astro-3ii7xxms">RSS</span>  </a> </li> </ul>   <script aria-hidden="true">
		(() => {
			const scroller = document.getElementById('starlight__sidebar');
			if (!window._starlightScrollRestore || !scroller) return;
			scroller.scrollTop = window._starlightScrollRestore;
			delete window._starlightScrollRestore;
		})();
	</script> </sl-sidebar-state-persist>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-wu23bvmt"> <div class="social-icons astro-wu23bvmt"> <nav aria-label="Navbar" class="astro-7ecetekw"> <ul class="main-nav astro-7ecetekw"> <li class="has-dropdown astro-7ecetekw"> <a href="awesome" class="astro-7ecetekw">推荐</a> <ul class="dropdown-menu astro-7ecetekw"> <li class=" astro-7ecetekw"> <a href="https://awesome-tools.vibesparking.com/" class="astro-7ecetekw">推荐 工具</a>  </li> </ul> </li><li class="has-dropdown astro-7ecetekw"> <a href="products" class="astro-7ecetekw">产品</a> <ul class="dropdown-menu astro-7ecetekw"> <li class=" astro-7ecetekw"> <a href="https://ingest2ai.vibesparking.com/" class="astro-7ecetekw">Ingest2AI</a>  </li> </ul> </li><li class="has-dropdown astro-7ecetekw"> <a href="wellness" class="astro-7ecetekw">健康</a> <ul class="dropdown-menu astro-7ecetekw"> <li class=" astro-7ecetekw"> <a href="wellness/sleep" class="astro-7ecetekw">睡眠</a>  </li><li class=" astro-7ecetekw"> <a href="wellness/fitness" class="astro-7ecetekw">健身</a>  </li><li class=" astro-7ecetekw"> <a href="wellness/relaxation" class="astro-7ecetekw">放松</a>  </li> </ul> </li><li class=" astro-7ecetekw"> <a href="wealth" class="astro-7ecetekw">财富</a>  </li><li class="has-dropdown astro-7ecetekw"> <a href="growth" class="astro-7ecetekw">成长</a> <ul class="dropdown-menu astro-7ecetekw"> <li class=" astro-7ecetekw"> <a href="ai/vibe-coding" class="astro-7ecetekw">AI 灵感编程</a>  </li> </ul> </li> </ul> </nav>   <a href="https://github.com/VibeSparkingAI/vs-sites-astro.github.io" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg></a><a href="https://www.vibesparking.com/blog/rss.xml" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">RSS</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M2.88 16.88a3 3 0 0 0 0 4.24 3 3 0 0 0 4.24 0 3 3 0 0 0-4.24-4.24Zm2.83 2.83a1 1 0 0 1-1.42-1.42 1 1 0 0 1 1.42 0 1 1 0 0 1 0 1.42ZM5 12a1 1 0 0 0 0 2 5 5 0 0 1 5 5 1 1 0 0 0 2 0 7 7 0 0 0-7-7Zm0-4a1 1 0 0 0 0 2 9 9 0 0 1 9 9 1 1 0 0 0 2 0 11.08 11.08 0 0 0-3.22-7.78A11.08 11.08 0 0 0 5 8Zm10.61.39A15.11 15.11 0 0 0 5 4a1 1 0 0 0 0 2 13 13 0 0 1 13 13 1 1 0 0 0 2 0 15.11 15.11 0 0 0-4.39-10.61Z"/></svg></a> </div> <div class="astro-eboeziq4"> <a href="/zh-cn/blog/" class="astro-eboeziq4">Blog</a> </div>  <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">选择主题</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> <select value="auto" autocomplete="off" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">深色</option><option value="light" class="astro-4yphtoen">浅色</option><option value="auto" selected class="astro-4yphtoen">自动</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>  <starlight-lang-select><label style="--sl-select-width: 7em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">选择语言</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path fill-rule="evenodd" d="M8.516 3a.94.94 0 0 0-.941.94v1.15H2.94a.94.94 0 1 0 0 1.882h7.362a7.422 7.422 0 0 1-1.787 3.958 7.42 7.42 0 0 1-1.422-2.425.94.94 0 1 0-1.774.627 9.303 9.303 0 0 0 1.785 3.043 7.422 7.422 0 0 1-4.164 1.278.94.94 0 1 0 0 1.881 9.303 9.303 0 0 0 5.575-1.855 9.303 9.303 0 0 0 4.11 1.74l-.763 1.525a.968.968 0 0 0-.016.034l-1.385 2.77a.94.94 0 1 0 1.683.841l1.133-2.267h5.806l1.134 2.267a.94.94 0 0 0 1.683-.841l-1.385-2.769a.95.95 0 0 0-.018-.036l-3.476-6.951a.94.94 0 0 0-1.682 0l-1.82 3.639a7.423 7.423 0 0 1-3.593-1.256 9.303 9.303 0 0 0 2.27-5.203h1.894a.94.94 0 0 0 0-1.881H9.456V3.94A.94.94 0 0 0 8.516 3Zm6.426 11.794a1.068 1.068 0 0 1-.02.039l-.703 1.407h3.924l-1.962-3.924-1.24 2.478Z" clip-rule="evenodd"/></svg> <select value="/zh-cn/blog/tags/harmonyos/" autocomplete="off" class="astro-4yphtoen"> <option value="/en/blog/tags/harmonyos/" class="astro-4yphtoen">English</option><option value="/zh-cn/blog/tags/harmonyos/" selected class="astro-4yphtoen">简体中文</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg> </label> </starlight-lang-select> </div>  </div> </div> </div> </nav> <div class="main-frame astro-vrdttmbt">  <script type="module">const a=document.getElementById("starlight__sidebar"),n=a?.querySelector("sl-sidebar-state-persist"),o="sl-sidebar-state",i=()=>{let t=[];const e=n?.dataset.hash||"";try{const s=sessionStorage.getItem(o),r=JSON.parse(s||"{}");Array.isArray(r.open)&&r.hash===e&&(t=r.open)}catch{}return{hash:e,open:t,scroll:a?.scrollTop||0}},c=t=>{try{sessionStorage.setItem(o,JSON.stringify(t))}catch{}},d=()=>c(i()),l=(t,e)=>{const s=i();s.open[e]=t,c(s)};n?.addEventListener("click",t=>{if(!(t.target instanceof Element))return;const e=t.target.closest("summary")?.closest("details");if(!e)return;const s=e.querySelector("sl-sidebar-restore"),r=parseInt(s?.dataset.index||"");isNaN(r)||l(!e.open,r)});addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&d()});addEventListener("pageHide",d);</script> <div class="lg:sl-flex astro-67yu43on"> <aside class="right-sidebar-container print:hidden astro-67yu43on"> <div class="right-sidebar astro-67yu43on"> <div class="lg:sl-hidden astro-pb3aqygn"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-bboabfps"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-bboabfps"><details id="starlight__mobile-toc" class="astro-bboabfps"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-bboabfps"><div class="toggle sl-flex astro-bboabfps">本页内容<svg aria-hidden="true" class="caret astro-bboabfps astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg></div><span class="display-current astro-bboabfps"></span></summary><div class="dropdown astro-bboabfps"><ul class="isMobile astro-4elwmllm" style="--depth: 0;"> <li class="astro-4elwmllm" style="--depth: 0;"> <a href="#_top" data-shb-heading="概述" class="astro-4elwmllm" style="--depth: 0;"> <span class="astro-7vjlygkt">概述</span> </a>  </li> </ul> </div></details></nav></mobile-starlight-toc><script type="module">const b="_top";class g extends HTMLElement{constructor(){super(),this._current=this.querySelector('a[aria-current="true"]'),this.minH=Number.parseInt(this.dataset.minH??"2",10),this.maxH=Number.parseInt(this.dataset.maxH??"3",10),this.isHeading=e=>{if(e instanceof HTMLHeadingElement){if(e.id===b)return!0;const c=e.tagName[1];if(c){const o=Number.parseInt(c,10);if(o>=this.minH&&o<=this.maxH)return!0}}return!1};const t=[...this.querySelectorAll("a")],n=e=>{if(!e)return null;const c=e;for(;e;){if(this.isHeading(e))return e;for(e=e.previousElementSibling;e?.lastElementChild;)e=e.lastElementChild;const o=n(e);if(o)return o}return n(c.parentElement)},r=e=>{for(const{isIntersecting:c,target:o}of e){if(!c)continue;const h=n(o);if(!h)continue;const m=t.find(p=>p.hash===`#${encodeURIComponent(h.id)}`);if(m){this.current=m;break}}},s=document.querySelectorAll("main [id], main [id] ~ *, main .content > *");let i;const d=()=>{i&&i.disconnect(),i=new IntersectionObserver(r,{rootMargin:this.getRootMargin()});for(const e of s)i.observe(e)};d();const f=globalThis.requestIdleCallback||(e=>setTimeout(e,1));let l;window.addEventListener("resize",()=>{i&&i.disconnect(),clearTimeout(l),l=setTimeout(()=>f(d),200)})}set current(t){t!==this._current&&(this._current&&this._current.removeAttribute("aria-current"),t.setAttribute("aria-current","true"),this._current=t)}get current(){return this._current}getRootMargin(){const t=document.querySelector("header")?.getBoundingClientRect().height??0,n=this.querySelector("summary")?.getBoundingClientRect().height??0,r=t+n+32,s=r+53,i=document.documentElement.clientHeight;return`-${r}px 0% ${s-i}px`}}customElements.define("starlight-toc",g);const E=["caution","danger","default","note","success","tip"],u="__SHB__",H="__SHB_SPACE__";function _(a){return E.includes(a)}function v(a){const t=a.split(" ").pop();if(!t)return;const n=t.split(u),[,r,s]=n;if(!(!r||!_(r)||!s))return{heading:a.replace(new RegExp(`${u}.*${u}`),""),text:s.replace(H," "),variant:r}}class x extends g{set current(t){super.current=t;const n=this.querySelector(".display-current");if(n){const r=t.dataset.shbHeading;if(r){const s=v(r);if(s){n.textContent="",n.append(document.createTextNode(`${s.heading} `));const i=document.createElement("span");i.textContent=s.text,i.dataset.shbBadge="",i.dataset.shbBadgeVariant=s.variant,n.append(i);return}}n.textContent=t.textContent}}get current(){return super.current}constructor(){super();const t=this.querySelector("details");if(!t)return;const n=()=>{t.open=!1};for(const r of t.querySelectorAll("a"))r.addEventListener("click",n);globalThis.addEventListener("click",r=>{t.contains(r.target)||n()}),globalThis.addEventListener("keydown",r=>{if(r.key==="Escape"&&t.open){const s=t.contains(document.activeElement);if(n(),s){const i=t.querySelector("summary");i&&i.focus()}}})}}customElements.define("mobile-starlight-toc",x);</script></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-pb3aqygn"><div class="sl-container astro-pb3aqygn"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">本页内容</h2><ul class="astro-4elwmllm" style="--depth: 0;"> <li class="astro-4elwmllm" style="--depth: 0;"> <a href="#_top" data-shb-heading="概述" class="astro-4elwmllm" style="--depth: 0;"> <span class="astro-7vjlygkt">概述</span> </a>  </li> </ul> </nav></starlight-toc></div></div> </div> </aside> <div class="main-pane astro-67yu43on">  <main class="astro-bguv2lll" lang="zh-CN" dir="ltr">    <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <h1 id="_top" class="astro-j6tvhyss">HarmonyOS</h1>  </div> </div>  <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <div class="sl-markdown-content">   <div class="count astro-bu4jbvld">4 posts with the tag “HarmonyOS”</div>  <div class="posts astro-xaz7kpyh"> <article class="preview astro-dr56dw7m"> <header class="astro-dr56dw7m"> <h2 class="astro-dr56dw7m"> <a href="/zh-cn/blog/ai/huawei/harmony-os/sop/2025-09-26-harmonyos-3x-claude-code-doc-bdd/" class="astro-dr56dw7m">用 Claude Code + 面向文档编程 + BDD 业务驱动测试，把华为鸿蒙 App 研发提速 3 倍</a> </h2> <div class="metadata not-content astro-2oxtfctb"> <div class="dates astro-2oxtfctb"> <time datetime="2025-09-26T00:00:00.000Z" class="astro-2oxtfctb"> 2025年9月26日 </time>  </div> <div class="authors astro-2oxtfctb"> <a href="https://www.vibesparking.com" class="author astro-kbhsbk7c"><img src="/assets/vibe-sparking-avatar-zh.jpg" alt="Vibe Sparking" loading="eager" decoding="async" fetchpriority="auto" width="40" height="40" class="astro-kbhsbk7c"><div class="text astro-kbhsbk7c"> <div class="name astro-kbhsbk7c">Vibe Sparking</div>  </div> </a>  </div>  </div>  </header> <div class="sl-markdown-content astro-dr56dw7m"> <!-- # 用 Claude Code + 面向文档编程 + BDD 业务驱动测试，把华为鸿蒙 App 研发提速 3 倍 -->
<blockquote>
<p>这套方法，专门解决「AI 能写代码，但不懂鸿蒙」「ArkTS 老报错」「回归测试跟不上」三大痛点。
<strong>核心是：用文档驱动 Claude Code，靠 BDD 自动化把质量兜住。</strong></p>
</blockquote>
<hr>
<div class="sl-heading-wrapper level-h2"><h2 id="引言别和-ai-胡扯先把文档写好">引言：别和 AI 胡扯，先把文档写好</h2><a class="sl-anchor-link" href="#引言别和-ai-胡扯先把文档写好"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “引言：别和 AI 胡扯，先把文档写好”</span></a></div>
<p>很多同学一上来就对 AI 说：“帮我做个蓝牙扫描、连接、同步时间的华为鸿蒙 App。”
结果 Claude Code 写得有模有样，<strong>一编译就全红</strong>。熟不熟 ArkTS？懂不懂 ArkUI 生命周期？测试咋回归？都没谱。</p>
<p>鸿蒙官方早就给出 <strong>ArkTS 编码规范</strong>、<strong>ArkUI 声明式开发范式</strong>、<strong>性能实践</strong>，这些是 Claude Code “学不会就老翻车”的坑位标准件 。
而 ArkTS 是 HarmonyOS 的主力语言，和 TypeScript 同宗但有自己的语义与生态，<strong>照 JS 的老习惯写，很容易踩坑</strong> 。
好消息是：Claude Code 已经支持“读仓库、编辑文件、写并运行测试、在终端执行命令”，只要把上下文喂对，它就能稳定输出工程化结果 。</p>
<hr>
<div class="sl-heading-wrapper level-h1"><h1 id="一面向文档编程让-claude-code-按你说的来">一、面向文档编程：让 Claude Code 按你说的来</h1><a class="sl-anchor-link" href="#一面向文档编程让-claude-code-按你说的来"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “一、面向文档编程：让 Claude Code 按你说的来”</span></a></div>
<p><strong>目标</strong>：把需求、价值、实现、验收，一页纸说清楚；让 Claude Code 在鸿蒙语境里“按章施工”。</p>
<div class="sl-heading-wrapper level-h3"><h3 id="1写一页纸需求可直接贴进仓库-docsfeature-xxxmd">1）写「一页纸」需求（可直接贴进仓库 <code dir="auto">/docs/feature-xxx.md</code>）</h3><a class="sl-anchor-link" href="#1写一页纸需求可直接贴进仓库-docsfeature-xxxmd"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1）写「一页纸」需求（可直接贴进仓库 /docs/feature-xxx.md）”</span></a></div>
<ul>
<li>
<p><strong>功能</strong>：蓝牙设备扫描 → 列表展示 → 连接 → 同步时间 → 读状态 → 发送命令 → 断开</p>
</li>
<li>
<p><strong>业务价值</strong>：门店导购 1 分钟完成设备初始化，减少 80% 人工失误</p>
</li>
<li>
<p><strong>平台</strong>：HarmonyOS NEXT，ArkTS + ArkUI；DevEco Studio 构建</p>
</li>
<li>
<p><strong>接口/模型</strong>：设备名以 <code dir="auto">XX</code> 开头；连接后展示电量；发送“注入”命令回传成功标志</p>
</li>
<li>
<p><strong>验收标准（BDD 口吻）</strong>：</p>
<ul>
<li><strong>Given</strong> 应用在首页</li>
<li><strong>When</strong> 点击「Start Scan」，在列表看到以 <code dir="auto">XX</code> 开头的设备并点击 Connect</li>
<li><strong>Then</strong> 进入已连接页，看到设备名/电量；点击「Sync Time」「Refresh Status」「Send injection Command」均返回成功</li>
</ul>
</li>
</ul>
<blockquote>
<p>ArkTS/ArkUI 的关键约束与最佳实践，记得在文档里抄要点：命名、状态管理、性能注意事项等（来自官方风格指南与状态管理指引）。<strong>把规范直接贴给 Claude Code</strong>，它会在生成时遵守这些规则 。</p>
</blockquote>
<div class="sl-heading-wrapper level-h3"><h3 id="2给-claude-code-的首条系统提示贴进-claudeprimermd">2）给 Claude Code 的首条系统提示（贴进 <code dir="auto">.claude/primer.md</code>）</h3><a class="sl-anchor-link" href="#2给-claude-code-的首条系统提示贴进-claudeprimermd"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “2）给 Claude Code 的首条系统提示（贴进 .claude/primer.md）”</span></a></div>
<ul>
<li>项目框架（ArkUI 页面结构、目录约定）</li>
<li>ArkTS 代码风格要求（变量/组件命名、可空判断、错误处理）</li>
<li>组件清单 &#x26; 事件流（Button → 扫描 → 列表 → 连接）</li>
<li><strong>测试先行</strong>：先生成 BDD 场景与 ArkTS 测试桩，再补业务代码</li>
<li>失败重试：编译错误→阅读错误→只改最小集</li>
</ul>
<blockquote>
<p>官方与社区都强调 <strong>以规范驱动编码</strong>，这能显著减少返工量与性能问题 。
Claude Code 本身也建议<strong>定制上下文与环境</strong>（例如忽略无关文件、给它一份专用 README/CONTRIBUTING），能明显提高命中率 。</p>
</blockquote>
<div class="sl-heading-wrapper level-h3"><h3 id="3把流程说明--验收步骤贴到-readme">3）把“流程说明 + 验收步骤”贴到 README</h3><a class="sl-anchor-link" href="#3把流程说明--验收步骤贴到-readme"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “3）把“流程说明 + 验收步骤”贴到 README”</span></a></div>
<p>下图是<strong>我们这次功能的人工验收步骤</strong>，用于人工核对与给 Claude Code 读上下文：</p>
<p><starlight-image-zoom-zoomable><img src="/mnt/data/a67c815f-5bb0-4fa0-aee7-a1010989a1ab.png" alt="Index/Connected 手工验收说明"><button aria-label="Zoom image: Index/Connected 手工验收说明" class="starlight-image-zoom-control"><svg aria-hidden="true" fill="currentColor" viewBox="0 0 24 24"><use href="#starlight-image-zoom-icon-zoom"></use></svg></button></starlight-image-zoom-zoomable></p>
<blockquote>
<p>这段文字会被 Claude Code 当成“<strong>可执行文档</strong>”来吸收：它能先写 UI 流，再补逻辑与测试（Claude 官方宣称可“写并运行测试、编辑文件、提交代码”）。</p>
</blockquote>
<hr>
<div class="sl-heading-wrapper level-h1"><h1 id="二bdd-业务驱动测试把文档变成可执行规范">二、BDD 业务驱动测试：把“文档”变成“可执行规范”</h1><a class="sl-anchor-link" href="#二bdd-业务驱动测试把文档变成可执行规范"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “二、BDD 业务驱动测试：把“文档”变成“可执行规范””</span></a></div>
<p><strong>一句话</strong>：需求写成 Gherkin 场景，测试跑在 DevEco/arkXtest 框架上，<strong>测试红→AI 修→再测绿</strong>。</p>
<div class="sl-heading-wrapper level-h3"><h3 id="1用-gherkin-描述业务">1）用 Gherkin 描述业务</h3><a class="sl-anchor-link" href="#1用-gherkin-描述业务"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1）用 Gherkin 描述业务”</span></a></div>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.v4551.css"><script type="module" src="/_astro/ec.8zarh.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="gherkin"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8844AE">Feature</span><span style="--0:#D6DEEB;--1:#403F53">:</span><span style="--0:#ECC48D;--1:#3B61B0"> Scan and connect device</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">Scenario</span><span style="--0:#D6DEEB;--1:#403F53">:</span><span style="--0:#ECC48D;--1:#3B61B0"> Find and connect device with prefix XX</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">Given </span><span style="--0:#D6DEEB;--1:#403F53">App on Index Page</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">When </span><span style="--0:#D6DEEB;--1:#403F53">I tap </span><span style="--0:#ECC48D;--1:#984E4D">"Start Scan"</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">Then </span><span style="--0:#D6DEEB;--1:#403F53">I should see a device starting with </span><span style="--0:#ECC48D;--1:#984E4D">"XX"</span><span style="--0:#D6DEEB;--1:#403F53"> in the list</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">When </span><span style="--0:#D6DEEB;--1:#403F53">I tap </span><span style="--0:#ECC48D;--1:#984E4D">"Connect"</span><span style="--0:#D6DEEB;--1:#403F53"> on that device</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">Then </span><span style="--0:#D6DEEB;--1:#403F53">I should be on Connected Page with name and battery shown</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="Feature: Scan and connect device  Scenario: Find and connect device with prefix XX    Given App on Index Page    When I tap &#x22;Start Scan&#x22;    Then I should see a device starting with &#x22;XX&#x22; in the list    When I tap &#x22;Connect&#x22; on that device    Then I should be on Connected Page with name and battery shown"><div></div></button></div></figure></div>
<blockquote>
<p>Gherkin/BDD 的优势是把“业务语言”直接变成<strong>可执行的规格</strong>，持续校验系统行为是否和文档一致 。</p>
</blockquote>
<div class="sl-heading-wrapper level-h3"><h3 id="2arkts-测试落地选型">2）ArkTS 测试落地选型</h3><a class="sl-anchor-link" href="#2arkts-测试落地选型"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “2）ArkTS 测试落地选型”</span></a></div>
<ul>
<li><strong>DevEco/arkXtest 体系</strong>：提供 <strong>单元测试 + UI 测试 + 性能测试</strong> 的统一框架；UI 测试脚本执行在单测之上，满足端到端验证需求 。</li>
<li><strong>IDE 支持</strong>：DevEco Studio 集成了测试框架与代码测试入口，便于在真机/模拟器执行 。</li>
</ul>
<blockquote>
<p>一些资料还提到 HarmonyOS/ArkTS 在 NEXT 版本对测试能力升级，支持更现代的写法与参数化等技巧，可按需借鉴到你的工程模板里（以官方与权威资料为准） 。</p>
</blockquote>
<div class="sl-heading-wrapper level-h3"><h3 id="3示例ui-场景测试骨架摘自实际项目结构">3）示例：UI 场景测试骨架（摘自实际项目结构）</h3><a class="sl-anchor-link" href="#3示例ui-场景测试骨架摘自实际项目结构"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “3）示例：UI 场景测试骨架（摘自实际项目结构）”</span></a></div>
<p><starlight-image-zoom-zoomable><img src="/mnt/data/e7abf7c3-ef3d-4faf-beeb-e80911484aab.png" alt="ArkTS UI 场景测试片段"><button aria-label="Zoom image: ArkTS UI 场景测试片段" class="starlight-image-zoom-control"><svg aria-hidden="true" fill="currentColor" viewBox="0 0 24 24"><use href="#starlight-image-zoom-icon-zoom"></use></svg></button></starlight-image-zoom-zoomable></p>
<p>这个测试干了三件事：</p>
<ol>
<li>若未扫描就尝试点「Start Scan」，否则写日志跳过</li>
<li>等待发现设备</li>
<li>定位包含指定前缀的设备并点击连接，<strong>断言进入已连接页</strong></li>
</ol>
<blockquote>
<p>这类 UI 测试用例结构，和 arkXtest 的设计思路一致：<strong>用 API 驱动 UI 操作，统一在测试框架里收敛结果</strong> 。</p>
</blockquote>
<div class="sl-heading-wrapper level-h3"><h3 id="4把测试红ai-修复再测绿做成流水线">4）把“测试红→AI 修复→再测绿”做成流水线</h3><a class="sl-anchor-link" href="#4把测试红ai-修复再测绿做成流水线"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4）把“测试红→AI 修复→再测绿”做成流水线”</span></a></div>
<ul>
<li><strong>Claude Code 回路</strong>：失败就把<strong>编译/运行日志</strong>贴回对话，让它最小改动修复（Claude 官方建议的“环境调优 + 上下文最小化”在这里很关键） 。</li>
<li><strong>IDE/CI 集成</strong>：在 DevEco Studio 本地一键跑；CI 上接入真机/模拟器跑回归（参考 DevEco 测试入口与官方测试文档） 。</li>
<li><strong>可视化验收</strong>：把前面的<strong>人工验收步骤图</strong>放到 wiki，每个版本都跑 Gherkin + UI 测试，保证“文档即真相”。</li>
</ul>
<hr>
<div class="sl-heading-wrapper level-h1"><h1 id="三落地手册从-0-到-1-的-7-步-checklist">三、落地手册：从 0 到 1 的 7 步 Checklist</h1><a class="sl-anchor-link" href="#三落地手册从-0-到-1-的-7-步-checklist"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “三、落地手册：从 0 到 1 的 7 步 Checklist”</span></a></div>
<p><strong>Step 1｜项目初始化</strong></p>
<ul>
<li>DevEco Studio 创建 ArkTS 项目；选择 ArkUI 声明式范式；确认目标 API/设备。</li>
<li>建议拉一份 <strong>ArkTS 风格指南</strong> 与 <strong>性能实践</strong> 入库 <code dir="auto">/guides</code>，供人和 AI 同时参考 。</li>
</ul>
<p><strong>Step 2｜一页纸需求</strong></p>
<ul>
<li>写清功能、价值、接口、状态、异常、<strong>验收场景（Given/When/Then）</strong>。</li>
<li>把截图式的人工验收步骤放进 README（上文配图那段）。</li>
</ul>
<p><strong>Step 3｜Claude Code 启动</strong></p>
<ul>
<li>把 <code dir="auto">.claude/primer.md</code> 和 <code dir="auto">/docs</code> 作为<strong>首要上下文</strong>；限制它读取无关大文件。</li>
<li>让它<strong>先生成测试桩 &#x26; Gherkin</strong>，再补业务代码与 ArkUI 页面 。</li>
</ul>
<p><strong>Step 4｜ArkTS/ArkUI 编码</strong></p>
<ul>
<li>遵守命名、组件化、状态管理约束；注意性能实践与可空/异常处理 。</li>
</ul>
<p><strong>Step 5｜测试实现</strong></p>
<ul>
<li>采用 <strong>arkXtest / DevEco 测试</strong> 跑单测+UI 测试；把 Gherkin 作为顶层用例描述（可在步骤定义里调用 UI 测试 API） 。</li>
</ul>
<p><strong>Step 6｜循环修复</strong></p>
<ul>
<li>失败日志丢给 Claude Code 进行<strong>最小修复</strong>；本地/CI 循环跑到全绿 。</li>
</ul>
<p><strong>Step 7｜沉淀知识库</strong></p>
<ul>
<li>把踩坑 &#x26; FAQ 记录到 <code dir="auto">/kb</code>：如 BLE 权限、生命周期、列表性能。</li>
<li>下一次仅需改“一页纸”和少量步骤描述，Claude Code 就能<strong>复用上下文继续生成</strong>。</li>
</ul>
<hr>
<div class="sl-heading-wrapper level-h1"><h1 id="四效果质量速度认知三线齐飞">四、效果：质量、速度、认知，三线齐飞</h1><a class="sl-anchor-link" href="#四效果质量速度认知三线齐飞"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “四、效果：质量、速度、认知，三线齐飞”</span></a></div>
<ul>
<li><strong>速度</strong>：有了“文档即代码”的喂法，Claude Code 在鸿蒙项目上更稳定，<strong>减少来回猜</strong> 。</li>
<li><strong>质量</strong>：arkXtest + DevEco 测试把<strong>单测/UI/性能</strong>拉齐，回归自动化，人工只做探索式验证 。</li>
<li><strong>认知</strong>：规范与性能实践写进文档，<strong>人和 AI 同一套规则</strong>，新同学 1 天能上手 ArkTS/ArkUI 的基本套路 。</li>
</ul>
<hr>
<div class="sl-heading-wrapper level-h1"><h1 id="五可复制模板你可以直接拷走">五、可复制模板（你可以直接拷走）</h1><a class="sl-anchor-link" href="#五可复制模板你可以直接拷走"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “五、可复制模板（你可以直接拷走）”</span></a></div>
<div class="sl-heading-wrapper level-h3"><h3 id="文档目录建议">文档目录建议</h3><a class="sl-anchor-link" href="#文档目录建议"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “文档目录建议”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="plaintext"><code><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">/docs</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">feature-ble-connect.md      # 一页纸需求+验收</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">ui-flow.md                  # 界面流程与状态</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">/guides</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">arkts-style-guide.md        # 摘抄+链接官方规范</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">performance-notes.md        # ArkTS 性能实践</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">/tests</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">features/ble_connect.feature  # Gherkin</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">ui/ble_connect.test.ets       # UI 场景测试</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">.kb</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#d6deeb;--1:#403f53">  </span></span><span style="--0:#d6deeb;--1:#403f53">ble-permissions.md</span></div></div><div class="ec-line"><div class="code"><span style="--0:#d6deeb;--1:#403f53">.claude/primer.md</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="/docs  feature-ble-connect.md      # 一页纸需求+验收  ui-flow.md                  # 界面流程与状态/guides  arkts-style-guide.md        # 摘抄+链接官方规范  performance-notes.md        # ArkTS 性能实践/tests  features/ble_connect.feature  # Gherkin  ui/ble_connect.test.ets       # UI 场景测试.kb  ble-permissions.md.claude/primer.md"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="feature-ble-connectmd-片段"><code dir="auto">feature-ble-connect.md</code> 片段</h3><a class="sl-anchor-link" href="#feature-ble-connectmd-片段"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “feature-ble-connect.md 片段”</span></a></div>
<ul>
<li>背景/价值</li>
<li>约束（API/权限/设备前缀）</li>
<li><strong>验收场景</strong>（5～7 条 Given/When/Then）</li>
<li>灰度/回滚策略</li>
</ul>
<hr>
<div class="sl-heading-wrapper level-h2"><h2 id="结语让文档测试代码成闭环">结语：让“文档—测试—代码”成闭环</h2><a class="sl-anchor-link" href="#结语让文档测试代码成闭环"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “结语：让“文档—测试—代码”成闭环”</span></a></div>
<p>当你把<strong>文档写到能直接验收</strong>，Claude Code 才有可能一次就写对 ArkTS；
当你把<strong>BDD 场景跑起来</strong>，每个版本都能一键回归。
这就是我们在鸿蒙项目里稳定拿到“<strong>更快的速度 + 更稳的质量</strong>”的原因。</p>
<p>你觉得这套玩法还缺什么？<strong>评论区聊聊你的场景</strong>。</p>
<!-- 
---

## 推荐标题（多语 & slug）

1. **把鸿蒙 App 研发提速 3 倍：Claude Code × 文档驱动 × BDD 回归闭环**

   * EN: Triple Your HarmonyOS Dev Speed: Claude Code × Doc-Driven × BDD
   * 繁體: 把鴻蒙 App 研發提速 3 倍：Claude Code × 文件驅動 × BDD
   * 日本語: HarmonyOS開発を3倍速に：Claude Code × ドキュメント駆動 × BDD
   * FR: Développez 3× plus vite sur HarmonyOS : Claude Code × Docs × BDD
   * ES: Triplica tu desarrollo HarmonyOS: Claude Code × Docs × BDD
   * PT: Triplique seu dev no HarmonyOS: Claude Code × Docs × BDD
   * slug: `harmonyos-3x-claude-code-doc-bdd`

2. **AI 会写但别乱写：用一页纸文档+BDD，让 ArkTS 不再红**

   * EN: AI Writes, You Control: One-Pager + BDD to Keep ArkTS Green
   * 繁體: AI 會寫但別亂寫：一頁紙 + BDD，ArkTS 不再紅
   * 日本語: AIに任せすぎない：One-Pager＋BDDでArkTSを常時グリーン
   * FR: L’IA code, vous cadrez : One-Pager + BDD pour un ArkTS au vert
   * ES: La IA codifica, tú mandas: One-Pager + BDD para ArkTS en verde
   * PT: IA codifica, você comanda: One-Pager + BDD para ArkTS verde
   * slug: `arkts-one-pager-bdd-green`

3. **从文档到可执行：Claude Code 把需求直接跑成测试与代码**

   * EN: From Docs to Executable: Claude Code Turns Specs into Tests & Code
   * 繁體: 從文件到可執行：Claude Code 把需求變成測試與程式
   * 日本語: 仕様が走る：Claude Codeがテストとコードに直変換
   * FR: Des specs au code exécutable : Claude Code en action
   * ES: De la especificación al código ejecutable con Claude Code
   * PT: Da especificação ao código executável com Claude Code
   * slug: `docs-to-executable-claude-code`

---

## 封面与配图（插画风 2:1，英文文字）

> 你可以把下面的提示词交给画图工具使用（不在图片内显示中文）。

**封面图 Prompt**
“Clean illustration, wide 2:1 canvas. A developer bridges three pillars labeled ‘Claude Code’, ‘Doc-Driven’, and ‘BDD’. Minimal HarmonyOS-style UI elements, terminal window, and test green checkmarks. Soft gradients, modern tech vibe.”

**章节配图 1｜面向文档编程**
“2:1 illustration. A single ‘One-Pager Spec’ sheet feeding into a code editor with ArkTS/ArkUI components. Arrows from spec to code, checklist icons.”

**章节配图 2｜BDD 自动化回归**
“2:1 illustration. Gherkin feature blocks flowing into a test runner dashboard. Red-to-green progress bar, device emulator, and CI badge.”

> 真实项目截图已插入相应段落（测试代码与人工验收步骤）。

---

## 朋友圈/评论区爆款文案（3 选 1）

1. “AI 能写代码，但别让它乱写。试了这招：一页纸+BDD，Claude Code 在鸿蒙项目里第一次就过编译，回归一键全绿，真香～”
2. “以前写鸿蒙，编译器天天骂我。现在先写文档再写代码，Claude Code 乖得像实习生，ArkTS 不再红。”
3. “把需求写成 Gherkin，让文档自己会跑。鸿蒙 App 研发提速 3 倍，周末还能健身了。”

---

需要我把**一页纸模板、Gherkin 示例、arkXtest 框架脚手架**打成仓库结构给你？或者针对你现在的功能点，**直接出一套可跑的测试与页面骨架**也行。你说需求，我这就开干。 --> </div> <footer class="astro-dr56dw7m"> <div class="astro-sg3lsd66"><b class="astro-sg3lsd66">Tags:</b><ul class="astro-sg3lsd66"><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/claude-code/" class="astro-sg3lsd66">Claude Code</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/ddd/" class="astro-sg3lsd66">DDD</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/doocumentation-driven-development/" class="astro-sg3lsd66">Doocumentation-Driven Development</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/bdd/" class="astro-sg3lsd66">BDD</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/behavior-driven-development/" class="astro-sg3lsd66">Behavior-Driven Development</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/arkts/" class="astro-sg3lsd66">ArkTS</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/harmonyos/" class="astro-sg3lsd66">HarmonyOS</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/ble/" class="astro-sg3lsd66">BLE</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/bluetooth-low-energy/" class="astro-sg3lsd66">Bluetooth Low Energy</a></li></ul></div> </footer> </article> <article class="preview astro-dr56dw7m"> <header class="astro-dr56dw7m"> <h2 class="astro-dr56dw7m"> <a href="/zh-cn/blog/ai/huawei/harmony-os/ble/2025-09-22-claude-code-harmonyos-ble/" class="astro-dr56dw7m">Claude Code 自动迁移 HarmonyOS BLE v15+ 多路扫描与连接管理</a> </h2> <div class="metadata not-content astro-2oxtfctb"> <div class="dates astro-2oxtfctb"> <time datetime="2025-09-22T00:00:00.000Z" class="astro-2oxtfctb"> 2025年9月22日 </time>  </div> <div class="authors astro-2oxtfctb"> <a href="https://www.vibesparking.com" class="author astro-kbhsbk7c"><img src="/assets/vibe-sparking-avatar-zh.jpg" alt="Vibe Sparking" loading="eager" decoding="async" fetchpriority="auto" width="40" height="40" class="astro-kbhsbk7c"><div class="text astro-kbhsbk7c"> <div class="name astro-kbhsbk7c">Vibe Sparking</div>  </div> </a>  </div>  </div>  </header> <div class="sl-markdown-content astro-dr56dw7m"> <div class="sl-heading-wrapper level-h1"><h1 id="用-claude-code-快速开发-harmonyos-6-蓝牙设备管理-app蓝牙交互arkts-编译修复与-tddbdd-实战">用 Claude Code 快速开发 HarmonyOS 6 蓝牙设备管理 App：蓝牙交互、ArkTS 编译修复与 TDD/BDD 实战</h1><a class="sl-anchor-link" href="#用-claude-code-快速开发-harmonyos-6-蓝牙设备管理-app蓝牙交互arkts-编译修复与-tddbdd-实战"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “用 Claude Code 快速开发 HarmonyOS 6 蓝牙设备管理 App：蓝牙交互、ArkTS 编译修复与 TDD/BDD 实战”</span></a></div>
<p>本文演示如何借助 Claude Code 快速完成一款面向华为 HarmonyOS 6 的蓝牙设备管理 App，覆盖典型能力：接收蓝牙广播、连接设备、设置时间、同步状态、输注、获取日志；并重点介绍 ArkTS 编译错误修复思路，以及以 TDD/BDD 为导向的测试落地。</p>
<p>—— 适合希望以“边写边测、快速迭代”打造 BLE 设备应用的团队。</p>
<div class="sl-heading-wrapper level-h2"><h2 id="一开发目标与设备协议概览">一、开发目标与设备协议概览</h2><a class="sl-anchor-link" href="#一开发目标与设备协议概览"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “一、开发目标与设备协议概览”</span></a></div>
<ul>
<li>目标设备：蓝牙设备。</li>
<li>典型指令：
<ul>
<li>读取状态、同步时间、输注、读取记录。</li>
</ul>
</li>
</ul>
<p>实现文件与数据模型：</p>
<ul>
<li><code dir="auto">entry/src/main/ets/utils/BleService.ets</code> 扫描与发现、连接、通知、命令发送等一站式封装。</li>
<li><code dir="auto">entry/src/main/ets/utils/BleCommand.ets</code> 指令构造（含 CRC 与长度、时间/剂量编码）。</li>
<li><code dir="auto">entry/src/main/ets/utils/BleResponseParser.ets</code> 响应解析。</li>
<li><code dir="auto">entry/src/main/ets/utils/BleAdvertisingParser.ets</code> 广播数据解析（本地名、UUID、厂商数据等）。</li>
</ul>
<div class="sl-heading-wrapper level-h2"><h2 id="二claude-code-如何加速-arkts-原生开发">二、Claude Code 如何加速 ArkTS 原生开发</h2><a class="sl-anchor-link" href="#二claude-code-如何加速-arkts-原生开发"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “二、Claude Code 如何加速 ArkTS 原生开发”</span></a></div>
<ul>
<li>代码导航与重构
<ul>
<li>通过指令快速定位 BLE 相关入口、交叉引用与依赖；批量改名与接口抽取保持一致性。</li>
</ul>
</li>
<li>辅助修复 ArkTS 编译告警/错误
<ul>
<li>自动指出 <code dir="auto">arkts-no-spread</code>、<code dir="auto">unknown/any</code> 等规则触发点，给出替换写法与类型补全建议。</li>
</ul>
</li>
<li>生成测试骨架并补充断言
<ul>
<li>基于 Hypium 的单元测试、UI 集成测试样例可快速落地与扩展。</li>
</ul>
</li>
</ul>
<p>结合这些能力，可以形成“修改 → 运行测试 → 分析日志 → 修复/重构”的高频闭环，显著缩短从协议梳理到端到端可用的周期。</p>
<div class="sl-heading-wrapper level-h2"><h2 id="三蓝牙交互全流程拆解">三、蓝牙交互全流程拆解</h2><a class="sl-anchor-link" href="#三蓝牙交互全流程拆解"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “三、蓝牙交互全流程拆解”</span></a></div>
<div class="sl-heading-wrapper level-h3"><h3 id="1-接收蓝牙广播扫描与解析">1. 接收蓝牙广播（扫描与解析）</h3><a class="sl-anchor-link" href="#1-接收蓝牙广播扫描与解析"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1. 接收蓝牙广播（扫描与解析）”</span></a></div>
<ul>
<li>多路径扫描（HarmonyOS API v15+）：
<ul>
<li>入口：<code dir="auto">entry/src/main/ets/utils/BleService.ets</code> <code dir="auto">startScan(...)</code></li>
<li>事件：<code dir="auto">BLEDeviceFind</code> 持续上报，内部使用 <code dir="auto">BleAdvertisingParser</code> 解析本地名、服务 UUID、厂商数据等。</li>
</ul>
</li>
<li>广播解析：<code dir="auto">entry/src/main/ets/utils/BleAdvertisingParser.ets</code>
<ul>
<li>覆盖 Flags、完整/不完整 UUID、Manufacturer Specific Data 等主流 AD 类型，便于快速判断是否为目标设备。</li>
</ul>
</li>
</ul>
<p>配套的发现服务：<code dir="auto">entry/src/main/ets/utils/BleDiscoveryService.ets</code> 封装了发现列表、按 RSSI 排序、超时自动停止与“可信设备”缓存策略，UI 侧直接订阅状态/结果回调即可。</p>
<div class="sl-heading-wrapper level-h3"><h3 id="2-连接设备与开启通知">2. 连接设备与开启通知</h3><a class="sl-anchor-link" href="#2-连接设备与开启通知"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “2. 连接设备与开启通知”</span></a></div>
<ul>
<li>连接与服务发现后，写入前必须“先订阅、再开通知、再读一次”：
<ul>
<li>启用通知：<code dir="auto">entry/src/main/ets/utils/BleService.ets</code>
<ul>
<li>先 <code dir="auto">gattClient.on('BLECharacteristicChange', ...)</code> 订阅回调</li>
<li>再 <code dir="auto">setCharacteristicChangeNotification(..., true)</code> 开启</li>
<li>可选执行一次 <code dir="auto">readCharacteristicValue</code> 以“预热”通知通道（部分设备需要）</li>
</ul>
</li>
</ul>
</li>
<li>通知回调：<code dir="auto">entry/src/main/ets/utils/BleService.ets</code> <code dir="auto">onCharacteristicChanged(...)</code>
<ul>
<li>使用小写 UUID 比对，规避不同大小写带来的遗漏</li>
<li>将 <code dir="auto">characteristic.characteristicValue</code> 转为 <code dir="auto">ArrayBuffer</code> 后分发给待处理回调或统一协议解析</li>
</ul>
</li>
</ul>
<div class="sl-heading-wrapper level-h3"><h3 id="3-指令发送与调试">3. 指令发送与调试</h3><a class="sl-anchor-link" href="#3-指令发送与调试"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “3. 指令发送与调试”</span></a></div>
<ul>
<li>发送写入：<code dir="auto">entry/src/main/ets/utils/BleService.ets</code> <code dir="auto">sendCommand(...)</code>
<ul>
<li>ArkTS 禁用对象展开（no-spread），需直接修改 <code dir="auto">characteristicValue</code> 后写入</li>
<li>统一输出十六进制串以便排查：<code dir="auto">BleCommand.toHexString(...)</code></li>
</ul>
</li>
<li>指令构建：
<ul>
<li>读状态 <code dir="auto">entry/src/main/ets/utils/BleCommand.ets</code></li>
<li>同步时间 <code dir="auto">entry/src/main/ets/utils/BleCommand.ets</code></li>
<li>输注指令 <code dir="auto">entry/src/main/ets/utils/BleCommand.ets</code>（剂量 ×1000 转整数，小端写入）</li>
</ul>
</li>
</ul>
<div class="sl-heading-wrapper level-h3"><h3 id="4-同步时间与读取状态">4. 同步时间与读取状态</h3><a class="sl-anchor-link" href="#4-同步时间与读取状态"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4. 同步时间与读取状态”</span></a></div>
<ul>
<li>同步时间：<code dir="auto">entry/src/main/ets/utils/BleService.ets</code>，写入 0xA7 包含年月日周时分秒，完成后走通知通道校验。</li>
<li>读取状态：<code dir="auto">entry/src/main/ets/utils/BleService.ets</code> → 等待通知 → 解析：<code dir="auto">entry/src/main/ets/utils/BleResponseParser.ets</code>
<ul>
<li>解析电池状态、电压/电量、剩余剂量、单次/日上限、告警位、今日用量、最大日志条数等。</li>
</ul>
</li>
</ul>
<div class="sl-heading-wrapper level-h3"><h3 id="5-输注">5. 输注</h3><a class="sl-anchor-link" href="#5-输注"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5. 输注”</span></a></div>
<ul>
<li><code dir="auto">entry/src/main/ets/utils/BleService.ets</code> 调用 <code dir="auto">buildInjectionCommand(dose)</code></li>
<li><code dir="auto">entry/src/main/ets/utils/BleCommand.ets</code> 剂量按千分精度编码为 4 字节小端整数，满足“较大/高精度剂量”场景。</li>
<li>建议：
<ul>
<li>结合状态中的单次/日上限做前置校验，必要时分包或分次下发；</li>
<li>关注 MTU（典型 20 字节）限制与指令长度设计。</li>
</ul>
</li>
</ul>
<div class="sl-heading-wrapper level-h3"><h3 id="6-获取日志记录解析">6. 获取日志（记录解析）</h3><a class="sl-anchor-link" href="#6-获取日志记录解析"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “6. 获取日志（记录解析）”</span></a></div>
<ul>
<li>通知处理分流：<code dir="auto">entry/src/main/ets/utils/BleService.ets</code> <code dir="auto">processReceivedData(...)</code>
<ul>
<li>“ 路径调用记录解析：<code dir="auto">entry/src/main/ets/utils/BleResponseParser.ets</code> <code dir="auto">parseRecord(...)</code></li>
<li>支持注射记录与操作记录两类结构化数据。</li>
</ul>
</li>
<li>若需“按索引/类型拉取历史记录”，可在 <code dir="auto">BleCommand</code> 中补齐 <code dir="auto">READ_RECORD_WITH_TYPE </code> 构造（工程中已留注释模板），与上面的解析逻辑无缝对接。</li>
</ul>
<div class="sl-heading-wrapper level-h2"><h2 id="四arkts-编译错误与修复要点">四、ArkTS 编译错误与修复要点</h2><a class="sl-anchor-link" href="#四arkts-编译错误与修复要点"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “四、ArkTS 编译错误与修复要点”</span></a></div>
<p>文档汇总：<code dir="auto">docs/ble-arkts-fix-summary.md</code></p>
<ul>
<li>类属性缺失
<ul>
<li>如 <code dir="auto">connectionPromiseResolvers</code> 未声明，需补充为 <code dir="auto">Map&#x3C;string,  => void></code>，用于连接 Promise 的外部解析。</li>
</ul>
</li>
<li><code dir="auto">arkts-no-spread</code>
<ul>
<li>写特征值时禁止对象展开，直接改 <code dir="auto">existing.characteristicValue = ...</code>（见 <code dir="auto">BleService.ets</code> 段落）。</li>
</ul>
</li>
<li><code dir="auto">unknown/any</code> 与宽松字面量
<ul>
<li>通知回调中移除 <code dir="auto">Record&#x3C;string, string></code>/<code dir="auto">unknown</code> 临时断言，改为强类型访问；</li>
</ul>
</li>
<li>通知匹配与日志
<ul>
<li>UUID 小写比对，详细打印 <code dir="auto">service/char UUID</code> 与十六进制载荷，便于现场排障。</li>
</ul>
</li>
</ul>
<p>这些修复在不改变业务语义的前提下，让代码同时满足 ArkTS 语义与 Lint 规则，构建稳定且可维护。</p>
<div class="sl-heading-wrapper level-h2"><h2 id="五tdd-与-bdd-测试实践">五、TDD 与 BDD 测试实践</h2><a class="sl-anchor-link" href="#五tdd-与-bdd-测试实践"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “五、TDD 与 BDD 测试实践”</span></a></div>
<div class="sl-heading-wrapper level-h3"><h3 id="1-单元测试tdd">1. 单元测试（TDD）</h3><a class="sl-anchor-link" href="#1-单元测试tdd"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1. 单元测试（TDD）”</span></a></div>
<ul>
<li>设备发现与缓存
<ul>
<li><code dir="auto">entry/src/ohosTest/ets/test/BleDiscoveryService.test.ets</code></li>
<li><code dir="auto">entry/src/ohosTest/ets/test/DeviceCache.test.ets</code></li>
</ul>
</li>
<li>覆盖点：
<ul>
<li>扫描状态流转、按名称过滤、RSSI 排序、自动停止；</li>
<li>可信设备标记、缓存清理、容量上限、过期统计等。</li>
</ul>
</li>
<li>运行：
<ul>
<li><code dir="auto">hvigor test</code></li>
<li>按文件过滤：<code dir="auto">hvigor test --filter BleDiscoveryService</code></li>
</ul>
</li>
</ul>
<div class="sl-heading-wrapper level-h3"><h3 id="2-行为驱动bdd与-ui-集成">2. 行为驱动（BDD）与 UI 集成</h3><a class="sl-anchor-link" href="#2-行为驱动bdd与-ui-集成"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “2. 行为驱动（BDD）与 UI 集成”</span></a></div>
<ul>
<li>场景用例：<code dir="auto">entry/src/ohosTest/ets/test/BleUIIntegration.test.ets</code>
<ul>
<li>启动 → 开始扫描 → 发现设备 → 连接 → 同步时间/刷新状态/发送输注 → 断开。</li>
<li>利用 <code dir="auto">@kit.TestKit</code> 的 <code dir="auto">Driver</code> 查找按钮、点击与断言，保障“从 UI 到协议”的端到端路径。</li>
</ul>
</li>
<li>运行：
<ul>
<li>全量集成测试：<code dir="auto">hvigor test --integration</code></li>
</ul>
</li>
</ul>
<div class="sl-heading-wrapper level-h3"><h3 id="3-断言与超时策略">3. 断言与超时策略</h3><a class="sl-anchor-link" href="#3-断言与超时策略"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “3. 断言与超时策略”</span></a></div>
<ul>
<li>BLE 环节多为异步回调：为扫描/连接/写入/通知分别设置合理超时（如 5–15s），避免误报；</li>
<li>对关键 UI 文案与按钮可多次尝试查找，提升稳定性；</li>
<li>以十六进制日志为断言辅助（见 <code dir="auto">BleService.ets</code>/<code dir="auto">BleService.ets</code>）。</li>
</ul>
<div class="sl-heading-wrapper level-h2"><h2 id="六实战建议与常见坑">六、实战建议与常见坑</h2><a class="sl-anchor-link" href="#六实战建议与常见坑"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “六、实战建议与常见坑”</span></a></div>
<ul>
<li>通知顺序与“预热”
<ul>
<li>订阅 → 打开通知 → 先读一次，能显著提升部分设备第一次下行响应的成功率。</li>
</ul>
</li>
<li>MTU 与指令长度
<ul>
<li>典型 BLE 4.2 仅 20 字节，复杂指令需要分拆或升级端侧/固件侧协商策略。</li>
</ul>
</li>
<li>小端编码与 CRC
<ul>
<li>指令总长度、字段编码与 CRC16（CCITT/False）计算需与固件严格对齐。</li>
</ul>
</li>
<li>HiLog 代替 console
<ul>
<li>统一域/Tag 与 <code dir="auto">%{public}</code> 输出（见 <code dir="auto">docs/hilog-migration-summary.md</code>），便于线下与现场定位。</li>
</ul>
</li>
<li>权限与蓝牙状态
<ul>
<li>统一入口：<code dir="auto">entry/src/main/ets/utils/BlePermissionManager.ets</code> <code dir="auto">ensureBleReady(...)</code>，在进入扫描前一次性处理权限与适配器状态。</li>
</ul>
</li>
</ul>
<div class="sl-heading-wrapper level-h2"><h2 id="七结语与下一步">七、结语与下一步</h2><a class="sl-anchor-link" href="#七结语与下一步"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “七、结语与下一步”</span></a></div>
<p>得益于 Claude Code 的“代码导航 + 编译修复 + 测试生成功能”，我们用最少的往返就完成了从协议梳理到端到端跑通的闭环：</p>
<ul>
<li>蓝牙交互：扫描、连接、通知、命令、记录解析全链路打通；</li>
<li>ArkTS 修复：严格遵循语义与 Lint 规则，构建稳定；</li>
<li>TDD/BDD：单元与 UI 集成测试覆盖主要场景，便于持续回归。</li>
</ul>
<p>推荐的后续工作：</p>
<ul>
<li>在 <code dir="auto">BleCommand</code> 中补齐 <code dir="auto">READ_RECORD_WITH_TYPE </code> 指令构造，与现有解析对接，完善“按索引拉取日志”。</li>
<li>引入更细粒度的 ViewModel 层状态管理与数据持久化，配合记录同步形成完整“云-端-设备”闭环。</li>
<li>梳理异常码与重试策略，增强断网/重连下的健壮性。</li>
</ul> </div> <footer class="astro-dr56dw7m"> <div class="astro-sg3lsd66"><b class="astro-sg3lsd66">Tags:</b><ul class="astro-sg3lsd66"><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/claude-code/" class="astro-sg3lsd66">Claude Code</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/arkts/" class="astro-sg3lsd66">ArkTS</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/harmonyos/" class="astro-sg3lsd66">HarmonyOS</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/ble/" class="astro-sg3lsd66">BLE</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/bluetooth-low-energy/" class="astro-sg3lsd66">Bluetooth Low Energy</a></li></ul></div> </footer> </article> <article class="preview astro-dr56dw7m"> <header class="astro-dr56dw7m"> <h2 class="astro-dr56dw7m"> <a href="/zh-cn/blog/ai/huawei/harmony-os/ble/2025-09-20-claude-code-auto-migrate-harmonyos-ble-v15-multi-scan-connection/" class="astro-dr56dw7m">Claude Code 自动迁移 HarmonyOS BLE v15+ 多路扫描与连接管理</a> </h2> <div class="metadata not-content astro-2oxtfctb"> <div class="dates astro-2oxtfctb"> <time datetime="2025-09-20T00:00:00.000Z" class="astro-2oxtfctb"> 2025年9月20日 </time>  </div> <div class="authors astro-2oxtfctb"> <a href="https://www.vibesparking.com" class="author astro-kbhsbk7c"><img src="/assets/vibe-sparking-avatar-zh.jpg" alt="Vibe Sparking" loading="eager" decoding="async" fetchpriority="auto" width="40" height="40" class="astro-kbhsbk7c"><div class="text astro-kbhsbk7c"> <div class="name astro-kbhsbk7c">Vibe Sparking</div>  </div> </a>  </div>  </div>  </header> <div class="sl-markdown-content astro-dr56dw7m"> <div class="sl-heading-wrapper level-h2"><h2 id="省流版">省流版</h2><a class="sl-anchor-link" href="#省流版"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “省流版”</span></a></div>
<p>之前项目中使用的 HarmonyOS BLE API 版本较低（v14及以前），存在单路扫描限制、资源管理不完善等问题。</p>
<p>现在使用Claude Code生成和修改代码，帮助我理解并自动迁移到最新的 HarmonyOS BLE API v15+，实现多路扫描和更健壮的连接管理。</p>
<p>最后总结记录了从 v14 迁移到 v15+ 的完整过程，重点介绍多路扫描支持、广播数据解析和连接管理优化。</p>
<div class="sl-heading-wrapper level-h2"><h2 id="背景">背景</h2><a class="sl-anchor-link" href="#背景"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “背景”</span></a></div>
<p>在 HarmonyOS 生态中，BLE（Bluetooth Low Energy）是智能设备互联的重要技术。随着应用需求的增加，单路扫描的限制逐渐显现，尤其是在需要同时扫描多个设备或服务的场景下。</p>
<p>HarmonyOS 在 API version 15 中引入了多路扫描支持，允许应用创建多个独立的扫描实例，提升了资源管理和扫描灵活性。</p>
<p>然而，现有项目代码仍然基于旧版 API，存在以下问题：</p>
<ol>
<li><strong>单路扫描限制</strong>：只能同时进行一个扫描任务，无法满足多设备扫描需求。</li>
<li><strong>资源管理不完善</strong>：扫描器实例未独立管理，导致状态混乱。</li>
<li><strong>缺少广播数据解析</strong>：扫描结果未解析广播数据，影响设备信息获取。</li>
<li><strong>连接管理简单</strong>：缺少重试和自动重连机制，影响连接稳定性。</li>
</ol>
<div class="sl-heading-wrapper level-h2"><h2 id="目标">目标</h2><a class="sl-anchor-link" href="#目标"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “目标”</span></a></div>
<p>基于最新的 HarmonyOS BLE API v15+，重构现有的 BLE 服务代码，实现以下目标：</p>
<ol>
<li><strong>多路扫描支持</strong>：允许同时运行多个扫描任务，每个任务独立管理。</li>
<li><strong>独立资源管理</strong>：每个扫描器实例独立控制，避免冲突。</li>
<li><strong>完整的广播数据解析</strong>：实现对 BLE 广播数据的解析功能。</li>
<li><strong>增强的连接管理</strong>：实现连接重试和自动重连机制，提升连接稳定性。</li>
<li><strong>现代化的异步处理</strong>：使用 Promise/async-await 处理异步 BLE 操作。</li>
</ol>
<div class="sl-heading-wrapper level-h2"><h2 id="迁移过程">迁移过程</h2><a class="sl-anchor-link" href="#迁移过程"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “迁移过程”</span></a></div>
<div class="sl-heading-wrapper level-h3"><h3 id="1-阅读官方文档">1. 阅读官方文档</h3><a class="sl-anchor-link" href="#1-阅读官方文档"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1. 阅读官方文档”</span></a></div>
<p>在开始迁移之前，首先需要下载官方文档，让 Claude Code 了解 HarmonyOS BLE API v15+ 的新特性和变更。</p>
<div class="sl-heading-wrapper level-h3"><h3 id="2-使用-claude-code-生成迁移建议">2. 使用 Claude Code 生成迁移建议</h3><a class="sl-anchor-link" href="#2-使用-claude-code-生成迁移建议"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “2. 使用 Claude Code 生成迁移建议”</span></a></div>
<p>我将官方文档内容提供给 Claude Code，并请求它分析现有代码中的问题，并执行迁移到最新 API 的步骤。</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.v4551.css"><script type="module" src="/_astro/ec.8zarh.js"></script><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="shell"><code><div class="ec-line"><div class="code"><span style="--0:#7FDBCA;--1:#096E72">></span><span style="--0:#D6DEEB;--1:#403F53"> @harmony-os-docs/cn/doc/harmonyos-guides/ble-development-guide.md 推荐使用API version</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">15开始支持的扫描方式，该方式支持应用发起和管理多路扫描。不要再使用</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">API</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">version</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">14及以前支持的扫描方式只支持应用发起单路扫描</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">⎿</span><span style="--0:#D6DEEB;--1:#403F53">  </span><span style="--0:#ECC48D;--1:#3B61B0">Read</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">harmony-os-docs/cn/doc/harmonyos-guides/ble-development-guide.md</span><span style="--0:#D6DEEB;--1:#403F53"> (806 </span><span style="--0:#ECC48D;--1:#3B61B0">lines</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3B61B0">⏺</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">我理解了，这份文档强调了HarmonyOS</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">BLE开发的重要更新：</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">关键要点</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">API版本升级建议：</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">-</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">推荐：使用API</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">version</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">15+的多路扫描方式</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">-</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">避免：API</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">version</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">14及以前的单路扫描方式</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">主要差异对比</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">API</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">v15+</span><span style="--0:#D6DEEB;--1:#403F53"> (推荐方式)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">//</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">创建独立的扫描实例，支持多路扫描管理</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C5E478;--1:#3B61B0">let</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">bleScanner:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">ble.BleScanner</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">ble.createBleScanner</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">//</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">订阅扫描结果</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">bleScanner.on(</span><span style="--0:#82AAFF;--1:#3B61B0">'BLEDeviceFind'</span><span style="--0:#82AAFF;--1:#3B61B0">,</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">onReceiveEvent</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">//</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">启动扫描</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">bleScanner.startScan([scanFilter],</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">scanOptions</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">//</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">停止扫描</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">bleScanner.stopScan</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">优势：</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">-</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">✅</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">支持多路并发扫描</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">-</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">✅</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">每个扫描实例独立管理</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">-</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">✅</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">更灵活的资源控制</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">-</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">✅</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">更好的扫描隔离性</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">API</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">v14及以前</span><span style="--0:#D6DEEB;--1:#403F53"> (不推荐)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">//</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">全局单例扫描，仅支持单路</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">ble.on(</span><span style="--0:#82AAFF;--1:#3B61B0">'BLEDeviceFind'</span><span style="--0:#82AAFF;--1:#3B61B0">,</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">onReceiveEvent</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">ble.startBLEScan([scanFilter],</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">scanOptions</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">ble.stopBLEScan</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">局限：</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">-</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">❌</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">仅支持单路扫描</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">-</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">❌</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">全局状态管理复杂</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">-</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">❌</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">无法同时管理多个扫描任务</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">实施建议</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">根据文档中的示例代码（BleScanManager类），建议项目采用以下架构：</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">1.</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">使用BleScanner实例管理：每个扫描任务创建独立的BleScanner实例</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">2.</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">封装扫描管理器：如文档中的BleScanManager类，统一管理扫描生命周期</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">3.</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">完整的广播解析：实现完整的BLE广播数据解析功能</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">4.</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">异步操作处理：使用Promise/async-await处理异步BLE操作</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">这种升级对于HarmonyOS项目特别重要，因为应用可能需要同时扫描多个设备或执行不同类型的扫描任务。</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3B61B0">我将基于HarmonyOS</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">API</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">v15+的最新规范重构BleService.ets，实现多路扫描管理和更现代化的BLE操作架构。</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3B61B0">⏺</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">代码分析</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">现有BleService.ets存在以下关键问题：</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">1.</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">使用已废弃的API</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">v14单路扫描：使用ble.startBLEScan</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#ECC48D;--1:#3B61B0">和ble.on</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#82AAFF;--1:#3B61B0">'BLEDeviceFind'</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">2.</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">缺少BLE广播数据解析：未解析扫描结果中的广播数据</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">3.</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">资源管理不完善：扫描器实例未独立管理</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">4.</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">错误处理简单：缺少细粒度的错误恢复机制</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C5E478;--1:#3B61B0">...</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="> @harmony-os-docs/cn/doc/harmonyos-guides/ble-development-guide.md 推荐使用API version  15开始支持的扫描方式，该方式支持应用发起和管理多路扫描。不要再使用 API version  14及以前支持的扫描方式只支持应用发起单路扫描  ⎿  Read harmony-os-docs/cn/doc/harmonyos-guides/ble-development-guide.md (806 lines)⏺ 我理解了，这份文档强调了HarmonyOS BLE开发的重要更新：  关键要点  API版本升级建议：  - 推荐：使用API version 15+的多路扫描方式  - 避免：API version 14及以前的单路扫描方式  主要差异对比  API v15+ (推荐方式)  // 创建独立的扫描实例，支持多路扫描管理  let bleScanner: ble.BleScanner = ble.createBleScanner();  // 订阅扫描结果  bleScanner.on(&#x27;BLEDeviceFind&#x27;, onReceiveEvent);  // 启动扫描  bleScanner.startScan([scanFilter], scanOptions);  // 停止扫描  bleScanner.stopScan();  优势：  - ✅ 支持多路并发扫描  - ✅ 每个扫描实例独立管理  - ✅ 更灵活的资源控制  - ✅ 更好的扫描隔离性  API v14及以前 (不推荐)  // 全局单例扫描，仅支持单路  ble.on(&#x27;BLEDeviceFind&#x27;, onReceiveEvent);  ble.startBLEScan([scanFilter], scanOptions);  ble.stopBLEScan();  局限：  - ❌ 仅支持单路扫描  - ❌ 全局状态管理复杂  - ❌ 无法同时管理多个扫描任务  实施建议  根据文档中的示例代码（BleScanManager类），建议项目采用以下架构：  1. 使用BleScanner实例管理：每个扫描任务创建独立的BleScanner实例  2. 封装扫描管理器：如文档中的BleScanManager类，统一管理扫描生命周期  3. 完整的广播解析：实现完整的BLE广播数据解析功能  4. 异步操作处理：使用Promise/async-await处理异步BLE操作  这种升级对于HarmonyOS项目特别重要，因为应用可能需要同时扫描多个设备或执行不同类型的扫描任务。我将基于HarmonyOS API v15+的最新规范重构BleService.ets，实现多路扫描管理和更现代化的BLE操作架构。⏺ 代码分析  现有BleService.ets存在以下关键问题：  1. 使用已废弃的API v14单路扫描：使用ble.startBLEScan()和ble.on(&#x27;BLEDeviceFind&#x27;)  2. 缺少BLE广播数据解析：未解析扫描结果中的广播数据  3. 资源管理不完善：扫描器实例未独立管理  4. 错误处理简单：缺少细粒度的错误恢复机制..."><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="3-生成迁移代码">3. 生成迁移代码</h3><a class="sl-anchor-link" href="#3-生成迁移代码"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “3. 生成迁移代码”</span></a></div>
<p>Claude Code 根据分析结果，生成了新的 <code dir="auto">BleService.ets</code> 代码，包含多路扫描支持、广播数据解析和增强的连接管理功能。</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="typescript"><code><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">481</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">482</span><span style="--0:#D6DEEB;--1:#403F53">      </span><span style="--0:#919F9F;--1:#5D6376">// Pending response callbacks</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">483</span><span style="--0:#D6DEEB;--1:#403F53">      private pendingCallbacks: Map</span><span style="--0:#C792EA;--1:#8844AE">&#x3C;</span><span style="--0:#D6DEEB;--1:#403F53">string, </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">data</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#FFCB8B">ArrayBuffer</span><span style="--0:#D9F5DD">)</span></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">void</span><span style="--0:#C792EA;--1:#8844AE">></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">Map</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">484</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">485</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#919F9F;--1:#5F636F">/**</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#919F9F;--1:#5F636F">       </span></span><span style="--0:#919F9F;--1:#5F636F">486 +     * Clean up scanner resources</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#919F9F;--1:#5F636F">       </span></span><span style="--0:#919F9F;--1:#5F636F">487 +     */</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">488</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">    private </span><span style="--0:#82AAFF;--1:#3B61B0">cleanupScanner</span><span style="--0:#D6DEEB;--1:#403F53">(scanId: string): </span><span style="--0:#7FDBCA;--1:#096E72">void</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">489</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">      </span><span style="--0:#919F9F;--1:#5D6376">// Clear timer</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">490</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">      </span><span style="--0:#C792EA;--1:#8844AE">const </span><span style="--0:#82AAFF;--1:#3B61B0">timer</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">scanTimers</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">get</span><span style="--0:#D6DEEB;--1:#403F53">(scanId);</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">491</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">      </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (timer) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">492</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3B61B0">clearTimeout</span><span style="--0:#D6DEEB;--1:#403F53">(timer);</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">493</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">scanTimers</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">delete</span><span style="--0:#D6DEEB;--1:#403F53">(scanId);</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">494</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">      }</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">495</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">496</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">      </span><span style="--0:#919F9F;--1:#5D6376">// Remove from active set</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">497</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">activeScanners</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">delete</span><span style="--0:#D6DEEB;--1:#403F53">(scanId);</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">498</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">499</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">      </span><span style="--0:#919F9F;--1:#5D6376">// Clean up scanner instance</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">500</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">bleScanners</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">delete</span><span style="--0:#D6DEEB;--1:#403F53">(scanId);</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">501</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">scanCallbacks</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">delete</span><span style="--0:#D6DEEB;--1:#403F53">(scanId);</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">502</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">    }</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">503</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">504</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#919F9F;--1:#5F636F">/**</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#919F9F;--1:#5F636F">       </span></span><span style="--0:#919F9F;--1:#5F636F">505 +     * Set up periodic cleanup of stale discovered devices</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#919F9F;--1:#5F636F">       </span></span><span style="--0:#919F9F;--1:#5F636F">506 +     */</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">507</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">    private </span><span style="--0:#82AAFF;--1:#3B61B0">setupDeviceCleanupTimer</span><span style="--0:#D6DEEB;--1:#403F53">(): </span><span style="--0:#7FDBCA;--1:#096E72">void</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">508</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">      </span><span style="--0:#82AAFF;--1:#3B61B0">setInterval</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">509</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8844AE">const </span><span style="--0:#82AAFF;--1:#3B61B0">now</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#D6DEEB;--1:#403F53">Date</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">now</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">510</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8844AE">const </span><span style="--0:#82AAFF;--1:#3B61B0">staleThreshold</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#F78C6C;--1:#AA0982">60000</span><span style="--0:#D6DEEB;--1:#403F53">; </span><span style="--0:#919F9F;--1:#5D6376">// 60 seconds</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">511</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">512</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8844AE">for</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8844AE">const [</span><span style="--0:#82AAFF;--1:#3B61B0">deviceId</span><span style="--0:#C792EA;--1:#8844AE">, </span><span style="--0:#82AAFF;--1:#3B61B0">lastSeen</span><span style="--0:#C792EA;--1:#8844AE">] </span><span style="--0:#7FDBCA;--1:#096E72">of</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">deviceLastSeenTime</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">entries</span><span style="--0:#D6DEEB;--1:#403F53">()) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">513</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">          </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (now </span><span style="--0:#C792EA;--1:#8844AE">-</span><span style="--0:#D6DEEB;--1:#403F53"> lastSeen </span><span style="--0:#C792EA;--1:#8844AE">></span><span style="--0:#D6DEEB;--1:#403F53"> staleThreshold) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">514</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#919F9F;--1:#5D6376">// Remove stale devices not connected</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">515</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8844AE">!</span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">connectedDevices</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">has</span><span style="--0:#D6DEEB;--1:#403F53">(deviceId)) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">516</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">              </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">discoveredDevices</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">delete</span><span style="--0:#D6DEEB;--1:#403F53">(deviceId);</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">517</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">              </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">deviceLastSeenTime</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">delete</span><span style="--0:#D6DEEB;--1:#403F53">(deviceId);</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">518</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">              hilog</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">info</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#82AAFF;--1:#3B61B0">DOMAIN</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#82AAFF;--1:#3B61B0">TAG</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3B61B0">Removed stale device: </span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">deviceId</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">519</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">            }</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">520</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">          }</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">521</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">        }</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">522</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">      }, </span><span style="--0:#F78C6C;--1:#AA0982">30000</span><span style="--0:#D6DEEB;--1:#403F53">); </span><span style="--0:#919F9F;--1:#5D6376">// Run every 30 seconds</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">523</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">    }</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">524</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">525</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#919F9F;--1:#5F636F">/**</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#919F9F;--1:#5F636F">       </span></span><span style="--0:#919F9F;--1:#5F636F">526 +     * Get all discovered devices (including non-connected)</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#919F9F;--1:#5F636F">       </span></span><span style="--0:#919F9F;--1:#5F636F">527 +     */</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">528</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">    public </span><span style="--0:#82AAFF;--1:#3B61B0">getDiscoveredDevices</span><span style="--0:#D6DEEB;--1:#403F53">(): BleDevice[] {</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">529</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">      </span><span style="--0:#C792EA;--1:#8844AE">return</span><span style="--0:#D6DEEB;--1:#403F53"> Array</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">discoveredDevices</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">values</span><span style="--0:#D6DEEB;--1:#403F53">());</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">530</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">    }</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">531</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">532</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#919F9F;--1:#5F636F">/**</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#919F9F;--1:#5F636F">       </span></span><span style="--0:#919F9F;--1:#5F636F">533 +     * Get active scanner IDs</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#919F9F;--1:#5F636F">       </span></span><span style="--0:#919F9F;--1:#5F636F">534 +     */</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">535</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">    public </span><span style="--0:#82AAFF;--1:#3B61B0">getActiveScanners</span><span style="--0:#D6DEEB;--1:#403F53">(): string[] {</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">536</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">      </span><span style="--0:#C792EA;--1:#8844AE">return</span><span style="--0:#D6DEEB;--1:#403F53"> Array</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">activeScanners</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">537</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">    }</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">538</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">539</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#919F9F;--1:#5F636F">/**</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#919F9F;--1:#5F636F">       </span></span><span style="--0:#919F9F;--1:#5F636F">540 +     * Create targeted scan for specific device</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#919F9F;--1:#5F636F">       </span></span><span style="--0:#919F9F;--1:#5F636F">541 +     */</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">542</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">    public async </span><span style="--0:#82AAFF;--1:#3B61B0">scanForDevice</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">543</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">      deviceId: string,</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">544</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">      timeout: number </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">10000</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">545</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">    ): </span><span style="--0:#C5E478;--1:#3B61B0">Promise</span><span style="--0:#C792EA;--1:#8844AE">&#x3C;</span><span style="--0:#D6DEEB;--1:#403F53">BleDevice </span><span style="--0:#C792EA;--1:#8844AE">|</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FF6A83;--1:#A24848">null</span><span style="--0:#C792EA;--1:#8844AE">></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">546</span><span style="--0:#D6DEEB;--1:#403F53"> +      return new Promise((resolve, reject) => {</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">547</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#C792EA;--1:#8844AE">const </span><span style="--0:#82AAFF;--1:#3B61B0">scanId</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3B61B0">targeted-</span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">deviceId</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#ECC48D;--1:#3B61B0">-</span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">Date</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">now</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">548</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">549</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">startScan</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">550</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">          scanId,</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">551</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">          </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">device</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">552</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (device</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">id</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">===</span><span style="--0:#D6DEEB;--1:#403F53"> deviceId) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">553</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">              </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">stopScan</span><span style="--0:#D6DEEB;--1:#403F53">(scanId);</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">554</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">              </span><span style="--0:#82AAFF;--1:#3B61B0">resolve</span><span style="--0:#D6DEEB;--1:#403F53">(device);</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">555</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">            }</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">556</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">          },</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">557</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">          { timeout }</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">558</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">        );</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">559</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">560</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#919F9F;--1:#5D6376">// Set timeout for not finding device</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">561</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">        </span><span style="--0:#82AAFF;--1:#3B61B0">setTimeout</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">562</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">          </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">activeScanners</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">has</span><span style="--0:#D6DEEB;--1:#403F53">(scanId)) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">563</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">stopScan</span><span style="--0:#D6DEEB;--1:#403F53">(scanId);</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">564</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">            </span><span style="--0:#82AAFF;--1:#3B61B0">resolve</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#FF6A83;--1:#A24848">null</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">565</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">          }</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">566</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">        }, timeout);</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">567</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">+</span><span style="--0:#D6DEEB;--1:#403F53">      });</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">568</span><span style="--0:#D6DEEB;--1:#403F53"> +    }</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#F78C6C;--1:#AA0982">569</span><span style="--0:#D6DEEB;--1:#403F53">    }</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="       481       482      // Pending response callbacks       483      private pendingCallbacks: Map<string, (data: ArrayBuffer) => void> = new Map();       484 +       485 +    /**       486 +     * Clean up scanner resources       487 +     */       488 +    private cleanupScanner(scanId: string): void {       489 +      // Clear timer       490 +      const timer = this.scanTimers.get(scanId);       491 +      if (timer) {       492 +        clearTimeout(timer);       493 +        this.scanTimers.delete(scanId);       494 +      }       495 +       496 +      // Remove from active set       497 +      this.activeScanners.delete(scanId);       498 +       499 +      // Clean up scanner instance       500 +      this.bleScanners.delete(scanId);       501 +      this.scanCallbacks.delete(scanId);       502 +    }       503 +       504 +    /**       505 +     * Set up periodic cleanup of stale discovered devices       506 +     */       507 +    private setupDeviceCleanupTimer(): void {       508 +      setInterval(() => {       509 +        const now = Date.now();       510 +        const staleThreshold = 60000; // 60 seconds       511 +       512 +        for (const [deviceId, lastSeen] of this.deviceLastSeenTime.entries()) {       513 +          if (now - lastSeen > staleThreshold) {       514 +            // Remove stale devices not connected       515 +            if (!this.connectedDevices.has(deviceId)) {       516 +              this.discoveredDevices.delete(deviceId);       517 +              this.deviceLastSeenTime.delete(deviceId);       518 +              hilog.info(DOMAIN, TAG, &#x60;Removed stale device: ${deviceId}&#x60;);       519 +            }       520 +          }       521 +        }       522 +      }, 30000); // Run every 30 seconds       523 +    }       524 +       525 +    /**       526 +     * Get all discovered devices (including non-connected)       527 +     */       528 +    public getDiscoveredDevices(): BleDevice[] {       529 +      return Array.from(this.discoveredDevices.values());       530 +    }       531 +       532 +    /**       533 +     * Get active scanner IDs       534 +     */       535 +    public getActiveScanners(): string[] {       536 +      return Array.from(this.activeScanners);       537 +    }       538 +       539 +    /**       540 +     * Create targeted scan for specific device       541 +     */       542 +    public async scanForDevice(       543 +      deviceId: string,       544 +      timeout: number = 10000       545 +    ): Promise<BleDevice | null> {       546 +      return new Promise((resolve, reject) => {       547 +        const scanId = &#x60;targeted-${deviceId}-${Date.now()}&#x60;;       548 +       549 +        this.startScan(       550 +          scanId,       551 +          (device) => {       552 +            if (device.id === deviceId) {       553 +              this.stopScan(scanId);       554 +              resolve(device);       555 +            }       556 +          },       557 +          { timeout }       558 +        );       559 +       560 +        // Set timeout for not finding device       561 +        setTimeout(() => {       562 +          if (this.activeScanners.has(scanId)) {       563 +            this.stopScan(scanId);       564 +            resolve(null);       565 +          }       566 +        }, timeout);       567 +      });       568 +    }       569    }"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="4-代码审查与测试">4. 代码审查与测试</h3><a class="sl-anchor-link" href="#4-代码审查与测试"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4. 代码审查与测试”</span></a></div>
<p>我对生成的代码进行了详细审查，确保符合项目需求，并在实际设备上进行了全面测试，验证多路扫描和连接管理功能的稳定性。</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="shell"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3B61B0">$</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">hdc</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">file</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">send</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">entry/build/default/outputs/ohosTest/entry-ohosTest-signed.hap</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#984E4D">data/local/tmp/6a550b34422f402d80438c69110c772e</span><span style="--0:#D9F5DD;--1:#111111">"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3B61B0">$</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">hdc</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">shell</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">bm</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">install</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">-p</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">data/local/tmp/6a550b34422f402d80438c69110c772e</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3B61B0">$</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">hdc</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">shell</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">rm</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">-rf</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">data/local/tmp/6a550b34422f402d80438c69110c772e</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3B61B0">Running</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">tests.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3B61B0">$</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">hdc</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">shell</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">aa</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">test</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">-b</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">com.vibersparking.ble_test</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">-m</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">entry_test</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">-s</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">unittest</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">OpenHarmonyTestRunner</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">-s</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">class</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">BleServiceTest</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">-s</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">timeout</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">15000</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3B61B0">Started</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">running</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">tests.</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3B61B0">Test</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">finished.</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="$ hdc file send entry/build/default/outputs/ohosTest/entry-ohosTest-signed.hap &#x22;data/local/tmp/6a550b34422f402d80438c69110c772e&#x22;$ hdc shell bm install -p data/local/tmp/6a550b34422f402d80438c69110c772e$ hdc shell rm -rf data/local/tmp/6a550b34422f402d80438c69110c772eRunning tests.$ hdc shell aa test -b com.vibersparking.ble_test -m entry_test -s unittest OpenHarmonyTestRunner -s class BleServiceTest -s timeout 15000Started running tests.Test finished."><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="5-总结文档">5. 总结文档</h3><a class="sl-anchor-link" href="#5-总结文档"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “5. 总结文档”</span></a></div>
<p>最后让Claude Code生成了完整的总结文件，记录了从HarmonyOS BLE API v14迁移到v15+的完整过程，包括多路扫描支持、广播数据解析和增强的连接管理功能。</p>
<div class="sl-heading-wrapper level-h2"><h2 id="核心变更">核心变更</h2><a class="sl-anchor-link" href="#核心变更"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “核心变更”</span></a></div>
<div class="sl-heading-wrapper level-h3"><h3 id="1-api版本对比">1. API版本对比</h3><a class="sl-anchor-link" href="#1-api版本对比"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1. API版本对比”</span></a></div>



































<table><thead><tr><th>特性</th><th>API v14及之前</th><th>API v15+</th></tr></thead><tbody><tr><td>扫描方式</td><td>单路扫描（全局）</td><td>多路扫描（实例化）</td></tr><tr><td>扫描器管理</td><td><code dir="auto">ble.startBLEScan()</code></td><td><code dir="auto">ble.createBleScanner()</code></td></tr><tr><td>扫描事件</td><td><code dir="auto">ble.on('BLEDeviceFind')</code></td><td><code dir="auto">bleScanner.on('BLEDeviceFind')</code></td></tr><tr><td>停止扫描</td><td><code dir="auto">ble.stopBLEScan()</code></td><td><code dir="auto">bleScanner.stopScan()</code></td></tr><tr><td>资源管理</td><td>全局状态</td><td>独立实例管理</td></tr></tbody></table>
<div class="sl-heading-wrapper level-h3"><h3 id="2-关键优势">2. 关键优势</h3><a class="sl-anchor-link" href="#2-关键优势"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “2. 关键优势”</span></a></div>
<ul>
<li><strong>多路并发扫描</strong>：支持同时运行多个扫描任务</li>
<li><strong>独立资源管理</strong>：每个扫描器独立控制，避免冲突</li>
<li><strong>更好的错误隔离</strong>：单个扫描失败不影响其他扫描</li>
<li><strong>灵活的过滤配置</strong>：每个扫描可设置独立过滤条件</li>
</ul>
<div class="sl-heading-wrapper level-h2"><h2 id="实现架构">实现架构</h2><a class="sl-anchor-link" href="#实现架构"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “实现架构”</span></a></div>
<div class="sl-heading-wrapper level-h3"><h3 id="核心服务结构">核心服务结构</h3><a class="sl-anchor-link" href="#核心服务结构"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “核心服务结构”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="typescript"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8844AE">export</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">class</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">BleService</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5D6376">// API v15+ 扫描器管理</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">private</span><span style="--0:#D6DEEB;--1:#403F53"> bleScanners</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">Map</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;</span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#889FB2;--1:#4D667B">ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FFCB8B;--1:#111111">BleScanner</span><span style="--0:#D6DEEB;--1:#403F53">> </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">Map</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">private</span><span style="--0:#D6DEEB;--1:#403F53"> activeScanners</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">Set</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;</span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--0:#D6DEEB;--1:#403F53">> </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">Set</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">private</span><span style="--0:#D6DEEB;--1:#403F53"> scanCallbacks</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">Map</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;</span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">device</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#FFCB8B">BleDevice</span><span style="--0:#D9F5DD">)</span></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">void</span><span style="--0:#D6DEEB;--1:#403F53">> </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">Map</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">private</span><span style="--0:#D6DEEB;--1:#403F53"> scanTimers</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">Map</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;</span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3B61B0">number</span><span style="--0:#D6DEEB;--1:#403F53">> </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">Map</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5D6376">// 设备缓存管理</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">private</span><span style="--0:#D6DEEB;--1:#403F53"> discoveredDevices</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">Map</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;</span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#FFCB8B;--1:#111111">BleDevice</span><span style="--0:#D6DEEB;--1:#403F53">> </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">Map</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">private</span><span style="--0:#D6DEEB;--1:#403F53"> deviceLastSeenTime</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">Map</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;</span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3B61B0">number</span><span style="--0:#D6DEEB;--1:#403F53">> </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">Map</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5D6376">// 连接管理</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">private</span><span style="--0:#D6DEEB;--1:#403F53"> autoReconnectDevices</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">Set</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;</span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--0:#D6DEEB;--1:#403F53">> </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">Set</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">private</span><span style="--0:#D6DEEB;--1:#403F53"> connectionRetryCount</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">Map</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;</span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#C5E478;--1:#3B61B0">number</span><span style="--0:#D6DEEB;--1:#403F53">> </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">Map</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="export class BleService {  // API v15+ 扫描器管理  private bleScanners: Map<string, ble.BleScanner> = new Map();  private activeScanners: Set<string> = new Set();  private scanCallbacks: Map<string, (device: BleDevice) => void> = new Map();  private scanTimers: Map<string, number> = new Map();  // 设备缓存管理  private discoveredDevices: Map<string, BleDevice> = new Map();  private deviceLastSeenTime: Map<string, number> = new Map();  // 连接管理  private autoReconnectDevices: Set<string> = new Set();  private connectionRetryCount: Map<string, number> = new Map();}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="多路扫描实现">多路扫描实现</h3><a class="sl-anchor-link" href="#多路扫描实现"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “多路扫描实现”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="typescript"><code><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">public </span><span style="--0:#82AAFF;--1:#3B61B0">startScan</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">scanId: string,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">callback: </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">device</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#FFCB8B">BleDevice</span><span style="--0:#D9F5DD">)</span></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">void</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">options</span><span style="--0:#C792EA;--1:#8844AE">?:</span><span style="--0:#D6DEEB;--1:#403F53"> BleStartScanOptions</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">): </span><span style="--0:#7FDBCA;--1:#096E72">void</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5D6376">// 检查扫描ID唯一性</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">activeScanners</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">has</span><span style="--0:#D6DEEB;--1:#403F53">(scanId)) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">hilog</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">warn</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#82AAFF;--1:#3B61B0">DOMAIN</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#82AAFF;--1:#3B61B0">TAG</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3B61B0">Scanner </span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">scanId</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#ECC48D;--1:#3B61B0"> already active</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">return</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">try</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#919F9F;--1:#5D6376">// 创建独立扫描器实例 (API v15+)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">const </span><span style="--0:#82AAFF;--1:#3B61B0">bleScanner</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#D6DEEB;--1:#403F53">ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">createBleScanner</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">bleScanners</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">set</span><span style="--0:#D6DEEB;--1:#403F53">(scanId, bleScanner);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">scanCallbacks</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">set</span><span style="--0:#D6DEEB;--1:#403F53">(scanId, callback);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#919F9F;--1:#5D6376">// 配置扫描过滤器</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">const </span><span style="--0:#82AAFF;--1:#3B61B0">scanFilters</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#C792EA;--1:#8844AE"> ble.</span><span style="--0:#FFCB8B;--1:#111111">ScanFilter</span><span style="--0:#D6DEEB;--1:#403F53">[]</span><span style="--0:#C792EA;--1:#8844AE"> =</span><span style="--0:#D6DEEB;--1:#403F53"> [];</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (options</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#7FDBCA;--1:#096E72">filterServiceUuid</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">scanFilters</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">push</span><span style="--0:#D6DEEB;--1:#403F53">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">        </span></span><span style="--0:#D6DEEB;--1:#403F53">serviceUuid: </span><span style="--0:#82AAFF;--1:#3B61B0">SERVICE_UUID</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">});</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#919F9F;--1:#5D6376">// 订阅扫描结果</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">bleScanner</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">on</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">BLEDeviceFind</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">scanReport</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--1:#111111"><span style="--0:#FFCB8B">ScanReport</span><span style="--0:#D9F5DD">)</span></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">onDeviceFoundV15</span><span style="--0:#D6DEEB;--1:#403F53">(scanId, scanReport);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#919F9F;--1:#5D6376">// 启动扫描</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">bleScanner</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">startScan</span><span style="--0:#D6DEEB;--1:#403F53">(scanFilters, scanOptions);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">activeScanners</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">add</span><span style="--0:#D6DEEB;--1:#403F53">(scanId);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#919F9F;--1:#5D6376">// 设置自动停止定时器</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">const </span><span style="--0:#82AAFF;--1:#3B61B0">timeout</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#D6DEEB;--1:#403F53">options</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#7FDBCA;--1:#096E72">timeout</span><span style="--0:#C792EA;--1:#8844AE"> || </span><span style="--0:#82AAFF;--1:#3B61B0">SCAN_TIMEOUT_MS</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">const </span><span style="--0:#82AAFF;--1:#3B61B0">timer</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#82AAFF;--1:#3B61B0">setTimeout</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#C792EA;--1:#8844AE"> => {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8844AE">      </span></span><span style="--0:#C792EA;--1:#8844AE">if </span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">activeScanners</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">has</span><span style="--0:#D6DEEB;--1:#403F53">(scanId))</span><span style="--0:#C792EA;--1:#8844AE"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">stopScan</span><span style="--0:#D6DEEB;--1:#403F53">(scanId)</span><span style="--0:#C792EA;--1:#8844AE">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8844AE">      </span></span><span style="--0:#C792EA;--1:#8844AE">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8844AE">    </span></span><span style="--0:#C792EA;--1:#8844AE">}, </span><span style="--0:#D6DEEB;--1:#403F53">timeout);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">scanTimers</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">set</span><span style="--0:#D6DEEB;--1:#403F53">(scanId, timer);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">} </span><span style="--0:#C792EA;--1:#8844AE">catch</span><span style="--0:#D6DEEB;--1:#403F53"> (error) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">cleanupScanner</span><span style="--0:#D6DEEB;--1:#403F53">(scanId);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">throw</span><span style="--0:#D6DEEB;--1:#403F53"> error;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="public startScan(  scanId: string,  callback: (device: BleDevice) => void,  options?: BleStartScanOptions): void {  // 检查扫描ID唯一性  if (this.activeScanners.has(scanId)) {    hilog.warn(DOMAIN, TAG, &#x60;Scanner ${scanId} already active&#x60;);    return;  }  try {    // 创建独立扫描器实例 (API v15+)    const bleScanner = ble.createBleScanner();    this.bleScanners.set(scanId, bleScanner);    this.scanCallbacks.set(scanId, callback);    // 配置扫描过滤器    const scanFilters: ble.ScanFilter[] = [];    if (options?.filterServiceUuid) {      scanFilters.push({        serviceUuid: SERVICE_UUID      });    }    // 订阅扫描结果    bleScanner.on(&#x27;BLEDeviceFind&#x27;, (scanReport: ble.ScanReport) => {      this.onDeviceFoundV15(scanId, scanReport);    });    // 启动扫描    bleScanner.startScan(scanFilters, scanOptions);    this.activeScanners.add(scanId);    // 设置自动停止定时器    const timeout = options?.timeout || SCAN_TIMEOUT_MS;    const timer = setTimeout(() => {      if (this.activeScanners.has(scanId)) {        this.stopScan(scanId);      }    }, timeout);    this.scanTimers.set(scanId, timer);  } catch (error) {    this.cleanupScanner(scanId);    throw error;  }}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="ble广播数据解析器">BLE广播数据解析器</h3><a class="sl-anchor-link" href="#ble广播数据解析器"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “BLE广播数据解析器”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="typescript"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8844AE">export</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">class</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">BleAdvertisingParser</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">public</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">parse</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">data</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#FFCB8B">ArrayBuffer</span><span style="--0:#D9F5DD">)</span></span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">ParsedAdvertisingData</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3B61B0">const</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#82AAFF;--1:#3B61B0">result</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#FFCB8B;--1:#111111">ParsedAdvertisingData</span><span style="--0:#C792EA;--1:#8844AE"> = {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8844AE">      </span></span><span style="--0:#C792EA;--1:#8844AE">serviceUuids:</span><span style="--0:#D6DEEB;--1:#403F53"> []</span><span style="--0:#C792EA;--1:#8844AE">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8844AE">      </span></span><span style="--0:#C792EA;--1:#8844AE">serviceSolicitationUuids:</span><span style="--0:#D6DEEB;--1:#403F53"> []</span><span style="--0:#C792EA;--1:#8844AE">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8844AE">      </span></span><span style="--0:#C792EA;--1:#8844AE">serviceData: </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#82AAFF;--1:#3B61B0">Map</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#C792EA;--1:#8844AE">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8844AE">      </span></span><span style="--0:#C792EA;--1:#8844AE">manufactureSpecificData: </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#82AAFF;--1:#3B61B0">Map</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#C792EA;--1:#8844AE">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8844AE">      </span></span><span style="--0:#C792EA;--1:#8844AE">rawData: </span><span style="--0:#D6DEEB;--1:#403F53">data</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8844AE">    </span></span><span style="--0:#C792EA;--1:#8844AE">}</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3B61B0">const</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#82AAFF;--1:#3B61B0">advData</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#82AAFF;--1:#3B61B0">Uint8Array</span><span style="--0:#D6DEEB;--1:#403F53">(data);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3B61B0">let</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#D6DEEB;--1:#403F53">position</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">while</span><span style="--0:#D6DEEB;--1:#403F53"> (position </span><span style="--0:#C792EA;--1:#8844AE">&#x3C;</span><span style="--0:#D6DEEB;--1:#403F53"> advData</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">byteLength</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#82AAFF;--1:#3B61B0">const</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#82AAFF;--1:#3B61B0">length</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#D6DEEB;--1:#403F53">advData[position</span><span style="--0:#C792EA;--1:#8844AE">++</span><span style="--0:#D6DEEB;--1:#403F53">];</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (length </span><span style="--0:#C792EA;--1:#8844AE">===</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8844AE">break</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#82AAFF;--1:#3B61B0">const</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#82AAFF;--1:#3B61B0">type</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#D6DEEB;--1:#403F53">advData[position</span><span style="--0:#C792EA;--1:#8844AE">++</span><span style="--0:#D6DEEB;--1:#403F53">];</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#82AAFF;--1:#3B61B0">const</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#82AAFF;--1:#3B61B0">dataLength</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#D6DEEB;--1:#403F53">length</span><span style="--0:#C792EA;--1:#8844AE"> - </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#82AAFF;--1:#3B61B0">const</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#82AAFF;--1:#3B61B0">dataStart</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#D6DEEB;--1:#403F53">position;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">switch</span><span style="--0:#D6DEEB;--1:#403F53"> (type) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#C792EA;--1:#8844AE">case</span><span style="--0:#D6DEEB;--1:#403F53"> AdvertisingDataType</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">FLAGS</span><span style="--0:#D6DEEB;--1:#403F53">:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">          </span></span><span style="--0:#D6DEEB;--1:#403F53">result</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">flags</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> advData[dataStart];</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#C792EA;--1:#8844AE">break</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#C792EA;--1:#8844AE">case</span><span style="--0:#D6DEEB;--1:#403F53"> AdvertisingDataType</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">LOCAL_NAME_COMPLETE</span><span style="--0:#D6DEEB;--1:#403F53">:</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">          </span></span><span style="--0:#D6DEEB;--1:#403F53">result</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">localName</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">parseString</span><span style="--0:#D6DEEB;--1:#403F53">(advData, dataStart, dataLength);</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#C792EA;--1:#8844AE">break</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#C792EA;--1:#8844AE">case</span><span style="--0:#D6DEEB;--1:#403F53"> AdvertisingDataType</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">SERVICE_UUID_16_COMPLETE</span><span style="--0:#D6DEEB;--1:#403F53">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">parseServiceUuids</span><span style="--0:#D6DEEB;--1:#403F53">(advData, dataStart, dataLength, </span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#D6DEEB;--1:#403F53">, result</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">serviceUuids</span><span style="--0:#C792EA;--1:#8844AE">!</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#C792EA;--1:#8844AE">break</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#C792EA;--1:#8844AE">case</span><span style="--0:#D6DEEB;--1:#403F53"> AdvertisingDataType</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">MANUFACTURER_SPECIFIC_DATA</span><span style="--0:#D6DEEB;--1:#403F53">:</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">parseManufacturerData</span><span style="--0:#D6DEEB;--1:#403F53">(advData, dataStart, dataLength, result</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">manufactureSpecificData</span><span style="--0:#C792EA;--1:#8844AE">!</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#C792EA;--1:#8844AE">break</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">position </span><span style="--0:#C792EA;--1:#8844AE">+=</span><span style="--0:#D6DEEB;--1:#403F53"> dataLength;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">return</span><span style="--0:#D6DEEB;--1:#403F53"> result;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="export class BleAdvertisingParser {  public parse(data: ArrayBuffer): ParsedAdvertisingData {    const result: ParsedAdvertisingData = {      serviceUuids: [],      serviceSolicitationUuids: [],      serviceData: new Map(),      manufactureSpecificData: new Map(),      rawData: data    };    const advData = new Uint8Array(data);    let position = 0;    while (position < advData.byteLength) {      const length = advData[position++];      if (length === 0) break;      const type = advData[position++];      const dataLength = length - 1;      const dataStart = position;      switch (type) {        case AdvertisingDataType.FLAGS:          result.flags = advData[dataStart];          break;        case AdvertisingDataType.LOCAL_NAME_COMPLETE:          result.localName = this.parseString(advData, dataStart, dataLength);          break;        case AdvertisingDataType.SERVICE_UUID_16_COMPLETE:          this.parseServiceUuids(advData, dataStart, dataLength, 2, result.serviceUuids!);          break;        case AdvertisingDataType.MANUFACTURER_SPECIFIC_DATA:          this.parseManufacturerData(advData, dataStart, dataLength, result.manufactureSpecificData!);          break;      }      position += dataLength;    }    return result;  }}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="增强的连接管理">增强的连接管理</h3><a class="sl-anchor-link" href="#增强的连接管理"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “增强的连接管理”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="typescript"><code><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">public async </span><span style="--0:#82AAFF;--1:#3B61B0">connectDevice</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">deviceId: string,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">options</span><span style="--0:#C792EA;--1:#8844AE">?:</span><span style="--0:#D6DEEB;--1:#403F53"> BleConnectOptions</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">): </span><span style="--0:#C5E478;--1:#3B61B0">Promise</span><span style="--0:#C792EA;--1:#8844AE">&#x3C;</span><span style="--0:#7FDBCA;--1:#096E72">void</span><span style="--0:#C792EA;--1:#8844AE">></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">const timeout </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> options</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#7FDBCA;--1:#096E72">timeout</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">||</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">CONNECTION_TIMEOUT_MS</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">const retryCount </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> options</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#7FDBCA;--1:#096E72">retryCount</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">||</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">const autoReconnect </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> options</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#7FDBCA;--1:#096E72">autoReconnect</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">!==</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FF6A83;--1:#A24848">false</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5D6376">// 实现重试逻辑</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">let lastError: Error </span><span style="--0:#C792EA;--1:#8844AE">|</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FF6A83;--1:#A24848">null</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FF6A83;--1:#A24848">null</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">for</span><span style="--0:#D6DEEB;--1:#403F53"> (let attempt </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">; attempt </span><span style="--0:#C792EA;--1:#8844AE">&#x3C;=</span><span style="--0:#D6DEEB;--1:#403F53"> retryCount; attempt</span><span style="--0:#C792EA;--1:#8844AE">++</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">try {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">await</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">connectWithTimeout</span><span style="--0:#D6DEEB;--1:#403F53">(deviceId, timeout);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (autoReconnect) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">autoReconnectDevices</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">add</span><span style="--0:#D6DEEB;--1:#403F53">(deviceId);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">return</span><span style="--0:#D6DEEB;--1:#403F53">; </span><span style="--0:#919F9F;--1:#5D6376">// 成功</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">} catch (error) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">lastError = error as Error;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#82AAFF;--1:#3B61B0">if</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--1:#403F53"><span style="--0:#D7DBE0">attempt</span><span style="--0:#D6DEEB"> &#x3C; </span><span style="--0:#D7DBE0">retryCount</span></span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#919F9F;--1:#5D6376">// 指数退避重试</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#82AAFF;--1:#3B61B0">const</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#82AAFF;--1:#3B61B0">delay</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#D6DEEB;--1:#403F53">Math</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">min</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">1000</span><span style="--0:#C792EA;--1:#8844AE"> * </span><span style="--0:#D6DEEB;--1:#403F53">Math</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">pow</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">2</span><span style="--0:#C792EA;--1:#8844AE">, </span><span style="--0:#D6DEEB;--1:#403F53">attempt</span><span style="--0:#C792EA;--1:#8844AE"> - </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#C792EA;--1:#8844AE">, </span><span style="--0:#F78C6C;--1:#AA0982">5000</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#C792EA;--1:#8844AE">await</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">delay</span><span style="--0:#D6DEEB;--1:#403F53">(delay);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">throw</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">Error</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3B61B0">Failed to connect after </span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">retryCount</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#ECC48D;--1:#3B61B0"> attempts: </span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">lastError</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#7FDBCA;--1:#096E72">message</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="public async connectDevice(  deviceId: string,  options?: BleConnectOptions): Promise<void> {  const timeout = options?.timeout || CONNECTION_TIMEOUT_MS;  const retryCount = options?.retryCount || 3;  const autoReconnect = options?.autoReconnect !== false;  // 实现重试逻辑  let lastError: Error | null = null;  for (let attempt = 1; attempt <= retryCount; attempt++) {    try {      await this.connectWithTimeout(deviceId, timeout);      if (autoReconnect) {        this.autoReconnectDevices.add(deviceId);      }      return; // 成功    } catch (error) {      lastError = error as Error;      if (attempt < retryCount) {        // 指数退避重试        const delay = Math.min(1000 * Math.pow(2, attempt - 1), 5000);        await this.delay(delay);      }    }  }  throw new Error(&#x60;Failed to connect after ${retryCount} attempts: ${lastError?.message}&#x60;);}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="迁移步骤">迁移步骤</h2><a class="sl-anchor-link" href="#迁移步骤"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “迁移步骤”</span></a></div>
<div class="sl-heading-wrapper level-h3"><h3 id="1-更新导入和类型定义">1. 更新导入和类型定义</h3><a class="sl-anchor-link" href="#1-更新导入和类型定义"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “1. 更新导入和类型定义”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="typescript"><code><div class="ec-line"><div class="code"><span style="--0:#919F9F;--1:#5D6376">// 添加新的接口定义</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8844AE">interface</span><span style="--0:#D6DEEB;--1:#403F53"> BleStartScanOptions {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">timeout</span><span style="--0:#7FDBCA;--1:#096E72">?:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">number</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">filterServiceUuid</span><span style="--0:#7FDBCA;--1:#096E72">?:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">boolean</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">filterManufacturerId</span><span style="--0:#7FDBCA;--1:#096E72">?:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">boolean</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8844AE">interface</span><span style="--0:#D6DEEB;--1:#403F53"> BleConnectOptions {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">timeout</span><span style="--0:#7FDBCA;--1:#096E72">?:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">number</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">retryCount</span><span style="--0:#7FDBCA;--1:#096E72">?:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">number</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">autoReconnect</span><span style="--0:#7FDBCA;--1:#096E72">?:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">boolean</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// 添加新的接口定义interface BleStartScanOptions {  timeout?: number;  filterServiceUuid?: boolean;  filterManufacturerId?: boolean;}interface BleConnectOptions {  timeout?: number;  retryCount?: number;  autoReconnect?: boolean;}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="2-替换扫描实现">2. 替换扫描实现</h3><a class="sl-anchor-link" href="#2-替换扫描实现"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “2. 替换扫描实现”</span></a></div>
<p><strong>旧代码 (v14):</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="typescript"><code><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">startBLEScan</span><span style="--0:#D6DEEB;--1:#403F53">([scanFilter], scanOptions);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">on</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">BLEDeviceFind</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">devices</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">Array</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;</span><span style="--0:#889FB2;--1:#4D667B">ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FFCB8B;--1:#111111">ScanResult</span><span style="--0:#D6DEEB;--1:#403F53">></span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">onDeviceFound</span><span style="--0:#D6DEEB;--1:#403F53">(devices);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">});</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="ble.startBLEScan([scanFilter], scanOptions);ble.on(&#x27;BLEDeviceFind&#x27;, (devices: Array<ble.ScanResult>) => {  this.onDeviceFound(devices);});"><div></div></button></div></figure></div>
<p><strong>新代码 (v15+):</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="typescript"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8844AE">const </span><span style="--0:#82AAFF;--1:#3B61B0">bleScanner</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#D6DEEB;--1:#403F53">ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">createBleScanner</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">bleScanner</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">on</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">BLEDeviceFind</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">scanReport</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--1:#111111"><span style="--0:#FFCB8B">ScanReport</span><span style="--0:#D9F5DD">)</span></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">onDeviceFoundV15</span><span style="--0:#D6DEEB;--1:#403F53">(scanId, scanReport);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">});</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">bleScanner</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">startScan</span><span style="--0:#D6DEEB;--1:#403F53">([scanFilter], scanOptions);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="const bleScanner = ble.createBleScanner();bleScanner.on(&#x27;BLEDeviceFind&#x27;, (scanReport: ble.ScanReport) => {  this.onDeviceFoundV15(scanId, scanReport);});bleScanner.startScan([scanFilter], scanOptions);"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="3-实现资源清理">3. 实现资源清理</h3><a class="sl-anchor-link" href="#3-实现资源清理"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “3. 实现资源清理”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="typescript"><code><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">private </span><span style="--0:#82AAFF;--1:#3B61B0">cleanupScanner</span><span style="--0:#D6DEEB;--1:#403F53">(scanId: string): </span><span style="--0:#7FDBCA;--1:#096E72">void</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5D6376">// 清理定时器</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">const </span><span style="--0:#82AAFF;--1:#3B61B0">timer</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">scanTimers</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">get</span><span style="--0:#D6DEEB;--1:#403F53">(scanId);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (timer) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3B61B0">clearTimeout</span><span style="--0:#D6DEEB;--1:#403F53">(timer);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">scanTimers</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">delete</span><span style="--0:#D6DEEB;--1:#403F53">(scanId);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5D6376">// 移除活动扫描器</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">activeScanners</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">delete</span><span style="--0:#D6DEEB;--1:#403F53">(scanId);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5D6376">// 清理扫描器实例</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">bleScanners</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">delete</span><span style="--0:#D6DEEB;--1:#403F53">(scanId);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">scanCallbacks</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">delete</span><span style="--0:#D6DEEB;--1:#403F53">(scanId);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="private cleanupScanner(scanId: string): void {  // 清理定时器  const timer = this.scanTimers.get(scanId);  if (timer) {    clearTimeout(timer);    this.scanTimers.delete(scanId);  }  // 移除活动扫描器  this.activeScanners.delete(scanId);  // 清理扫描器实例  this.bleScanners.delete(scanId);  this.scanCallbacks.delete(scanId);}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="4-添加设备缓存管理">4. 添加设备缓存管理</h3><a class="sl-anchor-link" href="#4-添加设备缓存管理"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “4. 添加设备缓存管理”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="typescript"><code><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">private </span><span style="--0:#82AAFF;--1:#3B61B0">setupDeviceCleanupTimer</span><span style="--0:#D6DEEB;--1:#403F53">(): </span><span style="--0:#7FDBCA;--1:#096E72">void</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">setInterval</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">const </span><span style="--0:#82AAFF;--1:#3B61B0">now</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#D6DEEB;--1:#403F53">Date</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">now</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">const </span><span style="--0:#82AAFF;--1:#3B61B0">staleThreshold</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#F78C6C;--1:#AA0982">60000</span><span style="--0:#D6DEEB;--1:#403F53">; </span><span style="--0:#919F9F;--1:#5D6376">// 60秒</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">deviceLastSeenTime</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">forEach</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--1:#403F53"><span style="--0:#D7DBE0">lastSeen</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">deviceId</span></span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (now </span><span style="--0:#C792EA;--1:#8844AE">-</span><span style="--0:#D6DEEB;--1:#403F53"> lastSeen </span><span style="--0:#C792EA;--1:#8844AE">></span><span style="--0:#D6DEEB;--1:#403F53"> staleThreshold) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8844AE">!</span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">connectedDevices</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">has</span><span style="--0:#D6DEEB;--1:#403F53">(deviceId)) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">discoveredDevices</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">delete</span><span style="--0:#D6DEEB;--1:#403F53">(deviceId);</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">deviceLastSeenTime</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">delete</span><span style="--0:#D6DEEB;--1:#403F53">(deviceId);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">        </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">});</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}, </span><span style="--0:#F78C6C;--1:#AA0982">30000</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="private setupDeviceCleanupTimer(): void {  setInterval(() => {    const now = Date.now();    const staleThreshold = 60000; // 60秒    this.deviceLastSeenTime.forEach((lastSeen, deviceId) => {      if (now - lastSeen > staleThreshold) {        if (!this.connectedDevices.has(deviceId)) {          this.discoveredDevices.delete(deviceId);          this.deviceLastSeenTime.delete(deviceId);        }      }    });  }, 30000);}"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="使用示例">使用示例</h2><a class="sl-anchor-link" href="#使用示例"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “使用示例”</span></a></div>
<div class="sl-heading-wrapper level-h3"><h3 id="基础扫描">基础扫描</h3><a class="sl-anchor-link" href="#基础扫描"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “基础扫描”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="typescript"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8844AE">const </span><span style="--0:#82AAFF;--1:#3B61B0">bleService</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#D6DEEB;--1:#403F53">BleService</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">getInstance</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#919F9F;--1:#5D6376">// 启动扫描</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">bleService</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">startScan</span><span style="--0:#D6DEEB;--1:#403F53">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">scan-1</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">device</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3B61B0">Found device: </span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">device</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">name</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">timeout: </span><span style="--0:#F78C6C;--1:#AA0982">30000</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">filterServiceUuid: </span><span style="--0:#FF6A83;--1:#A24848">true</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="const bleService = BleService.getInstance();// 启动扫描bleService.startScan(  &#x27;scan-1&#x27;,  (device) => {    console.log(&#x60;Found device: ${device.name}&#x60;);  },  {    timeout: 30000,    filterServiceUuid: true  });"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="多路并发扫描">多路并发扫描</h3><a class="sl-anchor-link" href="#多路并发扫描"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “多路并发扫描”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="typescript"><code><div class="ec-line"><div class="code"><span style="--0:#919F9F;--1:#5D6376">// 扫描特定服务</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">bleService</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">startScan</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">service-scan</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, callback1, {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">filterServiceUuid: </span><span style="--0:#FF6A83;--1:#A24848">true</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#919F9F;--1:#5D6376">// 扫描特定制造商</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">bleService</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">startScan</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">manufacturer-scan</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, callback2, {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">filterManufacturerId: </span><span style="--0:#FF6A83;--1:#A24848">true</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#919F9F;--1:#5D6376">// 通用扫描</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">bleService</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">startScan</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">general-scan</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, callback3, {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">timeout: </span><span style="--0:#F78C6C;--1:#AA0982">60000</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">});</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// 扫描特定服务bleService.startScan(&#x27;service-scan&#x27;, callback1, {  filterServiceUuid: true});// 扫描特定制造商bleService.startScan(&#x27;manufacturer-scan&#x27;, callback2, {  filterManufacturerId: true});// 通用扫描bleService.startScan(&#x27;general-scan&#x27;, callback3, {  timeout: 60000});"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h3"><h3 id="连接管理">连接管理</h3><a class="sl-anchor-link" href="#连接管理"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “连接管理”</span></a></div>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="typescript"><code><div class="ec-line"><div class="code"><span style="--0:#919F9F;--1:#5D6376">// 带重试和自动重连的连接</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8844AE">await</span><span style="--0:#D6DEEB;--1:#403F53"> bleService</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">connectDevice</span><span style="--0:#D6DEEB;--1:#403F53">(deviceId, {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">timeout: </span><span style="--0:#F78C6C;--1:#AA0982">10000</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">retryCount: </span><span style="--0:#F78C6C;--1:#AA0982">3</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">autoReconnect: </span><span style="--0:#FF6A83;--1:#A24848">true</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#919F9F;--1:#5D6376">// 监听连接状态</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">bleService</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">addConnectionStateListener</span><span style="--0:#D6DEEB;--1:#403F53">(deviceId, </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--1:#403F53"><span style="--0:#D7DBE0">state</span><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">prevState</span></span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">log</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3B61B0">Connection state changed: </span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">prevState</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#ECC48D;--1:#3B61B0"> -> </span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">state</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">});</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// 带重试和自动重连的连接await bleService.connectDevice(deviceId, {  timeout: 10000,  retryCount: 3,  autoReconnect: true});// 监听连接状态bleService.addConnectionStateListener(deviceId, (state, prevState) => {  console.log(&#x60;Connection state changed: ${prevState} -> ${state}&#x60;);});"><div></div></button></div></figure></div>
<div class="sl-heading-wrapper level-h2"><h2 id="最佳实践">最佳实践</h2><a class="sl-anchor-link" href="#最佳实践"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “最佳实践”</span></a></div>
<ol>
<li>
<p><strong>扫描管理</strong></p>
<ul>
<li>为每个扫描任务分配唯一ID</li>
<li>设置合理的超时时间</li>
<li>及时清理不需要的扫描器</li>
</ul>
</li>
<li>
<p><strong>设备缓存</strong></p>
<ul>
<li>实现过期机制避免内存泄漏</li>
<li>保留最近发现的设备信息</li>
<li>支持快速重连</li>
</ul>
</li>
<li>
<p><strong>错误处理</strong></p>
<ul>
<li>实现重试机制</li>
<li>使用指数退避策略</li>
<li>提供详细的错误日志</li>
</ul>
</li>
<li>
<p><strong>资源优化</strong></p>
<ul>
<li>避免重复扫描</li>
<li>合理设置扫描参数</li>
<li>及时释放GATT客户端</li>
</ul>
</li>
</ol>
<div class="sl-heading-wrapper level-h2"><h2 id="性能优化建议">性能优化建议</h2><a class="sl-anchor-link" href="#性能优化建议"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “性能优化建议”</span></a></div>
<ol>
<li>
<p><strong>扫描优化</strong></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="typescript"><code><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8844AE">const </span><span style="--0:#82AAFF;--1:#3B61B0">scanOptions</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#C792EA;--1:#8844AE"> ble.</span><span style="--0:#FFCB8B;--1:#111111">ScanOptions</span><span style="--0:#C792EA;--1:#8844AE"> = {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8844AE">  </span></span><span style="--0:#C792EA;--1:#8844AE">interval: </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#C792EA;--1:#8844AE">, </span><span style="--0:#919F9F;--1:#5D6376">// 无延迟报告</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8844AE">  </span></span><span style="--0:#C792EA;--1:#8844AE">dutyMode: </span><span style="--0:#D6DEEB;--1:#403F53">ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">ScanDuty</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">SCAN_MODE_LOW_LATENCY</span><span style="--0:#C792EA;--1:#8844AE">, </span><span style="--0:#919F9F;--1:#5D6376">// 低延迟模式</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8844AE">  </span></span><span style="--0:#C792EA;--1:#8844AE">matchMode: </span><span style="--0:#D6DEEB;--1:#403F53">ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">MatchMode</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">MATCH_MODE_AGGRESSIVE</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#919F9F;--1:#5D6376">// 激进匹配</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8844AE">}</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="const scanOptions: ble.ScanOptions = {  interval: 0, // 无延迟报告  dutyMode: ble.ScanDuty.SCAN_MODE_LOW_LATENCY, // 低延迟模式  matchMode: ble.MatchMode.MATCH_MODE_AGGRESSIVE // 激进匹配};"><div></div></button></div></figure></div>
</li>
<li>
<p><strong>连接优化</strong></p>
<ul>
<li>实现连接池管理</li>
<li>预先发现服务缓存</li>
<li>批量处理通知数据</li>
</ul>
</li>
<li>
<p><strong>内存管理</strong></p>
<ul>
<li>定期清理过期设备</li>
<li>限制缓存大小</li>
<li>避免内存泄漏</li>
</ul>
</li>
</ol>
<div class="sl-heading-wrapper level-h2"><h2 id="故障排查">故障排查</h2><a class="sl-anchor-link" href="#故障排查"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “故障排查”</span></a></div>
<div class="sl-heading-wrapper level-h3"><h3 id="常见问题">常见问题</h3><a class="sl-anchor-link" href="#常见问题"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “常见问题”</span></a></div>
<ol>
<li>
<p><strong>扫描无结果</strong></p>
<ul>
<li>检查蓝牙权限</li>
<li>验证蓝牙是否开启</li>
<li>确认过滤条件正确</li>
</ul>
</li>
<li>
<p><strong>连接失败</strong></p>
<ul>
<li>增加重试次数</li>
<li>延长超时时间</li>
<li>检查设备是否在范围内</li>
</ul>
</li>
<li>
<p><strong>资源泄漏</strong></p>
<ul>
<li>确保清理所有扫描器</li>
<li>正确关闭GATT客户端</li>
<li>清理事件监听器</li>
</ul>
</li>
</ol>
<div class="sl-heading-wrapper level-h2"><h2 id="总结">总结</h2><a class="sl-anchor-link" href="#总结"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “总结”</span></a></div>
<p>API v15+的升级带来了显著的改进：</p>
<ul>
<li>✅ 支持多路并发扫描</li>
<li>✅ 独立的资源管理</li>
<li>✅ 更好的错误隔离</li>
<li>✅ 灵活的配置选项</li>
<li>✅ 增强的稳定性</li>
</ul>
<p>通过遵循本指南，可以顺利完成从v14到v15+的迁移，充分利用新API的优势，提供更稳定、高效的BLE连接体验。</p> </div> <footer class="astro-dr56dw7m"> <div class="astro-sg3lsd66"><b class="astro-sg3lsd66">Tags:</b><ul class="astro-sg3lsd66"><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/claude-code/" class="astro-sg3lsd66">Claude Code</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/arkts/" class="astro-sg3lsd66">ArkTS</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/harmonyos/" class="astro-sg3lsd66">HarmonyOS</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/ble/" class="astro-sg3lsd66">BLE</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/bluetooth-low-energy/" class="astro-sg3lsd66">Bluetooth Low Energy</a></li></ul></div> </footer> </article> <article class="preview astro-dr56dw7m"> <header class="astro-dr56dw7m"> <h2 class="astro-dr56dw7m"> <a href="/zh-cn/blog/ai/huawei/harmony-os/2025-09-16-claude-code-arkts-harmonyos-ble-manager/" class="astro-dr56dw7m">Claude Code + ArkTS 开发鸿蒙 App：几分钟做出 BLE 低功耗蓝牙管理器</a> </h2> <div class="metadata not-content astro-2oxtfctb"> <div class="dates astro-2oxtfctb"> <time datetime="2025-09-16T00:00:00.000Z" class="astro-2oxtfctb"> 2025年9月16日 </time>  </div> <div class="authors astro-2oxtfctb"> <a href="https://www.vibesparking.com" class="author astro-kbhsbk7c"><img src="/assets/vibe-sparking-avatar-zh.jpg" alt="Vibe Sparking" loading="eager" decoding="async" fetchpriority="auto" width="40" height="40" class="astro-kbhsbk7c"><div class="text astro-kbhsbk7c"> <div class="name astro-kbhsbk7c">Vibe Sparking</div>  </div> </a>  </div>  </div>  </header> <div class="sl-markdown-content astro-dr56dw7m"> <!-- # Claude Code + ArkTS 开发鸿蒙 App：几分钟做出 BLE 低功耗蓝牙管理器 -->
<blockquote>
<p>用 Claude Code 做“懂鸿蒙 ArkTS 的结对程序员”，在 ArkTS 里写出能<strong>扫描 / 连接 / 读写 / 订阅</strong>的 BLE 管理器，真机可跑、日志可查、问题可排。</p>
</blockquote>
<p><starlight-image-zoom-zoomable><img src="/assets/ai/huawei/harmony-os/claude-code-harmony-os.png" alt=""><button aria-label="Zoom image" class="starlight-image-zoom-control"><svg aria-hidden="true" fill="currentColor" viewBox="0 0 24 24"><use href="#starlight-image-zoom-icon-zoom"></use></svg></button></starlight-image-zoom-zoomable></p>
<hr>
<div class="sl-heading-wrapper level-h2"><h2 id="引言为啥用-claude-code-搭-arkts">引言｜为啥用 Claude Code 搭 ArkTS？</h2><a class="sl-anchor-link" href="#引言为啥用-claude-code-搭-arkts"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “引言｜为啥用 Claude Code 搭 ArkTS？”</span></a></div>
<p>做 BLE 低功耗蓝牙管理器的都懂：<strong>协议细碎、厂商千差、版本在飞</strong>。HarmonyOS/ArkTS 的文档又多又散，新人上手容易迷路。
我的做法很接地气：<strong>把官方文档“喂”给 Claude Code</strong>，让它在代码区当“看着手册写代码”的搭档；我们专注业务和调试节奏。</p>
<ul>
<li>ArkTS 是鸿蒙原生首选语言，基于 TS 强化了静态检查与性能（官方定义与入门见这里 <a href="https://developer.huawei.com/consumer/cn/arkts/%EF%BC%89%E3%80%82">https://developer.huawei.com/consumer/cn/arkts/）。</a></li>
<li>BLE 在鸿蒙上走 <code dir="auto">@ohos.bluetooth.ble</code> 模块，核心能力：扫描、广播、GATT 客户端/服务端。</li>
<li>真正的数据交互走 <strong>GATT</strong>：读写特征、订阅通知。</li>
</ul>
<blockquote>
<p>这套组合拳的好处：<strong>减少瞎猜，直接照文档写</strong>；Claude Code 负责搜、比对、补全；我们控制架构、状态机与日志。</p>
</blockquote>
<hr>
<div class="sl-heading-wrapper level-h2"><h2 id="准备工作把文档放进-claude-的胃">准备工作｜把文档放进 Claude 的“胃”</h2><a class="sl-anchor-link" href="#准备工作把文档放进-claude-的胃"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “准备工作｜把文档放进 Claude 的“胃””</span></a></div>
<p><strong>0）目标背景</strong>
我们要用 ArkTS 做一个<strong>连接低功耗蓝牙设备（BLE）的 App</strong>。</p>
<p><strong>1）下载官方文档并在项目里建资料夹</strong>
到华为开发者官网拉 ArkTS &#x26; BLE 文档（含指南与 API 参考），离线放到项目 <code dir="auto">/harmony-os-docs/</code>。</p>
<p><starlight-image-zoom-zoomable><img src="/assets/ai/huawei/harmony-os/harmony-os-docs-md.png" alt=""><button aria-label="Zoom image" class="starlight-image-zoom-control"><svg aria-hidden="true" fill="currentColor" viewBox="0 0 24 24"><use href="#starlight-image-zoom-icon-zoom"></use></svg></button></starlight-image-zoom-zoomable></p>
<p><strong>2）写一份 <code dir="auto">CLAUDE.md</code>（示例）</strong>
把 Claude Code 当队友，请它<strong>严格参考</strong>这些文档，再帮你产出 ArkTS 代码与说明：</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.v4551.css"><script type="module" src="/_astro/ec.8zarh.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="md"><code><div class="ec-line"><div class="code"><span style="--0:#82B1FF;--1:#3B61B0"># CLAUDE.md（节选）</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">You are my ArkTS + BLE copilot. Always quote and align with these docs:</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#82B1FF;--1:#3B61B0">### ArkTS</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">-</span><span style="--0:#D6DEEB;--1:#403F53"> @harmony-os-docs/cn/doc/harmonyos-guides/typescript-to-arkts-migration-guide.md</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">-</span><span style="--0:#D6DEEB;--1:#403F53"> @harmony-os-docs/cn/doc/harmonyos-guides/arkts-coding-style-guide.md</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">-</span><span style="--0:#D6DEEB;--1:#403F53"> @harmony-os-docs/cn/doc/harmonyos-guides/arkts-high-performance-programming.md</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">-</span><span style="--0:#D6DEEB;--1:#403F53"> @harmony-os-docs/cn/doc/harmonyos-guides/arkts-migration-background.md</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">-</span><span style="--0:#D6DEEB;--1:#403F53"> @harmony-os-docs/cn/doc/harmonyos-guides/arkts-more-cases.md</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">-</span><span style="--0:#D6DEEB;--1:#403F53"> @harmony-os-docs/cn/doc/harmonyos-guides/introduction-to-arkts.md</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#82B1FF;--1:#3B61B0">### BLE (HarmonyOS)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">-</span><span style="--0:#D6DEEB;--1:#403F53"> @harmony-os-docs/cn/doc/best-practices/bpta-bluetooth-low-energy.md</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">-</span><span style="--0:#D6DEEB;--1:#403F53"> @harmony-os-docs/cn/doc/best-practices/bpta-reasonable-bluetooth-use.md</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">-</span><span style="--0:#D6DEEB;--1:#403F53"> @harmony-os-docs/cn/doc/harmonyos-guides/ble-development-guide.md</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">-</span><span style="--0:#D6DEEB;--1:#403F53"> @harmony-os-docs/cn/doc/harmonyos-guides/br-development-guide.md</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">-</span><span style="--0:#D6DEEB;--1:#403F53"> @harmony-os-docs/cn/doc/harmonyos-guides/gatt-development-guide.md</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">Rules:</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">-</span><span style="--0:#D6DEEB;--1:#403F53"> Prefer ArkTS idioms and coding style.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">-</span><span style="--0:#D6DEEB;--1:#403F53"> Cite doc path + section when uncertain.</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D9F5DD;--1:#111111">-</span><span style="--0:#D6DEEB;--1:#403F53"> If API differs by version, note the min API level &#x26; capability.</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="# CLAUDE.md（节选）You are my ArkTS + BLE copilot. Always quote and align with these docs:### ArkTS- @harmony-os-docs/cn/doc/harmonyos-guides/typescript-to-arkts-migration-guide.md- @harmony-os-docs/cn/doc/harmonyos-guides/arkts-coding-style-guide.md- @harmony-os-docs/cn/doc/harmonyos-guides/arkts-high-performance-programming.md- @harmony-os-docs/cn/doc/harmonyos-guides/arkts-migration-background.md- @harmony-os-docs/cn/doc/harmonyos-guides/arkts-more-cases.md- @harmony-os-docs/cn/doc/harmonyos-guides/introduction-to-arkts.md### BLE (HarmonyOS)- @harmony-os-docs/cn/doc/best-practices/bpta-bluetooth-low-energy.md- @harmony-os-docs/cn/doc/best-practices/bpta-reasonable-bluetooth-use.md- @harmony-os-docs/cn/doc/harmonyos-guides/ble-development-guide.md- @harmony-os-docs/cn/doc/harmonyos-guides/br-development-guide.md- @harmony-os-docs/cn/doc/harmonyos-guides/gatt-development-guide.mdRules:- Prefer ArkTS idioms and coding style.- Cite doc path + section when uncertain.- If API differs by version, note the min API level &#x26; capability."><div></div></button></div></figure></div>
<blockquote>
<p>这一步的关键是<strong>约束 Claude</strong>：不熟就查；不确定就标注。ArkTS 风格指引、性能建议都能直接引用到代码审查里。</p>
</blockquote>
<hr>
<div class="sl-heading-wrapper level-h2"><h2 id="快速打样arkts--ble-的基本动作">快速打样｜ArkTS + BLE 的基本动作</h2><a class="sl-anchor-link" href="#快速打样arkts--ble-的基本动作"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “快速打样｜ArkTS + BLE 的基本动作”</span></a></div>
<p><strong>权限与能力</strong>
在 <code dir="auto">entry/src/main/module.json5</code> 里声明所需权限（示例，按你的 API/版本微调）：</p>
<ul>
<li><code dir="auto">ohos.permission.USE_BLUETOOTH</code>（启用蓝牙）</li>
<li><code dir="auto">ohos.permission.DISCOVER_BLUETOOTH</code>（扫描 / 配置）</li>
<li><code dir="auto">ohos.permission.LOCATION</code>（扫描关联位置申请，按 UX 规范前台说明）</li>
</ul>
<p><strong>模块入口</strong>
ArkTS BLE 走 <code dir="auto">@ohos.bluetooth.ble</code>，扫描用事件 <code dir="auto">ble.on('BLEDeviceFind', cb)</code> 获取结果；发现设备后创建 <code dir="auto">GattClientDevice</code> 进行连接与 GATT 读写/订阅。</p>
<blockquote>
<p>官方“最佳实践：BLE 扫描/连接状态管理”对业务层状态机也有建议，可参考落库。</p>
</blockquote>
<hr>
<div class="sl-heading-wrapper level-h2"><h2 id="代码落地一个可用的-ble-管理器arkts">代码落地｜一个可用的 BLE 管理器（ArkTS）</h2><a class="sl-anchor-link" href="#代码落地一个可用的-ble-管理器arkts"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “代码落地｜一个可用的 BLE 管理器（ArkTS）”</span></a></div>
<p>启动 Claude Code，要求它实现：</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="shell"><code><div class="ec-line"><div class="code"><span style="--0:#7FDBCA;--1:#096E72">></span><span style="--0:#D6DEEB;--1:#403F53"> 写一个 </span><span style="--1:#3B61B0"><span style="--0:#ECC48D">`</span><span style="--0:#82AAFF">BleManager</span><span style="--0:#ECC48D">`</span></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">类，能**启用/扫描/连接/读写/订阅/断开**，并暴露状态与错误回调。</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3B61B0">位置：</span><span style="--1:#3B61B0"><span style="--0:#ECC48D">`</span><span style="--0:#82AAFF">entry/src/main/ets/utils/BleManager.ets</span><span style="--0:#ECC48D">`</span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3B61B0">能力：启用/扫描/连接/读写/订阅/断开/状态管理/关键日志</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="> 写一个 &#x60;BleManager&#x60; 类，能**启用/扫描/连接/读写/订阅/断开**，并暴露状态与错误回调。位置：&#x60;entry/src/main/ets/utils/BleManager.ets&#x60;能力：启用/扫描/连接/读写/订阅/断开/状态管理/关键日志"><div></div></button></div></figure></div>
<p>代码生成结果</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="ts"><code><div class="ec-line"><div class="code"><span style="--0:#919F9F;--1:#5D6376">// entry/src/main/ets/utils/BleManager.ets</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8844AE">import</span><span style="--0:#D6DEEB;--1:#403F53"> ble </span><span style="--0:#C792EA;--1:#8844AE">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">@ohos.bluetooth.ble</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8844AE">import</span><span style="--0:#D6DEEB;--1:#403F53"> { BusinessError } </span><span style="--0:#C792EA;--1:#8844AE">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">@ohos.base</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8844AE">type</span><span style="--0:#D6DEEB;--1:#403F53"> Device </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">deviceId</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--0:#D6DEEB;--1:#403F53">;           </span><span style="--0:#919F9F;--1:#5D6376">// 如 "XX:XX:XX:XX:XX:XX"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">name</span><span style="--0:#7FDBCA;--1:#096E72">?:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">rssi</span><span style="--0:#7FDBCA;--1:#096E72">?:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">number</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">advData</span><span style="--0:#7FDBCA;--1:#096E72">?:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">Uint8Array</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">};</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8844AE">type</span><span style="--0:#D6DEEB;--1:#403F53"> ConnectionState </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">idle</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">|</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">scanning</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">|</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">connecting</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">|</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">connected</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#C792EA;--1:#8844AE">export</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">class</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">BleManager</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">private</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">static</span><span style="--0:#D6DEEB;--1:#403F53"> _i</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">BleManager</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">static</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">I</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> { </span><span style="--0:#C792EA;--1:#8844AE">return</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">_i</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">??=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">BleManager</span><span style="--0:#D6DEEB;--1:#403F53">(); }</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">private</span><span style="--0:#D6DEEB;--1:#403F53"> state</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">ConnectionState</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">idle</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">private</span><span style="--0:#D6DEEB;--1:#403F53"> devices </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">Map</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;</span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#FFCB8B;--1:#111111">Device</span><span style="--0:#D6DEEB;--1:#403F53">>();</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">private</span><span style="--0:#D6DEEB;--1:#403F53"> gatt</span><span style="--0:#7FDBCA;--1:#096E72">?:</span><span style="--0:#D6DEEB;--1:#403F53"> ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FFCB8B;--1:#111111">GattClientDevice</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5D6376">// 业务侧订阅</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">onScan</span><span style="--0:#7FDBCA;--1:#096E72">?:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">list</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">Device</span><span style="--0:#D6DEEB;--1:#403F53">[]</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">void</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">onState</span><span style="--0:#7FDBCA;--1:#096E72">?:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">s</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#FFCB8B">ConnectionState</span><span style="--0:#D9F5DD">)</span></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">void</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">onNotify</span><span style="--0:#7FDBCA;--1:#096E72">?:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">opt</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> { service</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--0:#D6DEEB;--1:#403F53">; characteristic</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--0:#D6DEEB;--1:#403F53">; value</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">Uint8Array</span><span style="--0:#D6DEEB;--1:#403F53"> }</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">void</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">onError</span><span style="--0:#7FDBCA;--1:#096E72">?:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">e</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> { tag</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--0:#D6DEEB;--1:#403F53">; err</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">unknown</span><span style="--0:#D6DEEB;--1:#403F53"> }</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">void</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">private</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">setState</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">s</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--1:#111111"><span style="--0:#FFCB8B">ConnectionState</span><span style="--0:#D9F5DD">)</span></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">state</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> s;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">onState</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#D6DEEB;--1:#403F53">(s);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5F636F">/** 启动扫描 */</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">async</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">startScan</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">try</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">state</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">===</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">scanning</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8844AE">return</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">devices</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">clear</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#919F9F;--1:#5D6376">// 监听扫描事件（BLEDeviceFind 返回一组 ScanResult）</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">on</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">BLEDeviceFind</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">results</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">Array</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;</span><span style="--0:#889FB2;--1:#4D667B">ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FFCB8B;--1:#111111">ScanResult</span><span style="--0:#D6DEEB;--1:#403F53">></span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#C792EA;--1:#8844AE">for</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#82AAFF;--1:#3B61B0">const</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#82AAFF;--1:#3B61B0">it</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#7FDBCA;--1:#096E72">of</span><span style="--0:#D6DEEB;--1:#403F53"> results </span><span style="--0:#C792EA;--1:#8844AE">??</span><span style="--0:#D6DEEB;--1:#403F53"> []) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#82AAFF;--1:#3B61B0">const</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#82AAFF;--1:#3B61B0">id</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#D6DEEB;--1:#403F53">it</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">deviceId</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">devices</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">set</span><span style="--0:#D6DEEB;--1:#403F53">(id, {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">            </span></span><span style="--0:#D6DEEB;--1:#403F53">deviceId: id,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">            </span></span><span style="--0:#D6DEEB;--1:#403F53">name: it</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">deviceName</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">            </span></span><span style="--0:#D6DEEB;--1:#403F53">rssi: it</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">rssi</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">            </span></span><span style="--0:#D6DEEB;--1:#403F53">advData: it</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">advData</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">          </span></span><span style="--0:#D6DEEB;--1:#403F53">});</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">        </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">onScan</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#D6DEEB;--1:#403F53">(Array</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">devices</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">values</span><span style="--0:#D6DEEB;--1:#403F53">()));</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">});</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#919F9F;--1:#5D6376">// 开始扫描（可按需传 filter）</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">await</span><span style="--0:#D6DEEB;--1:#403F53"> ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">startBLEScan</span><span style="--0:#D6DEEB;--1:#403F53">(); </span><span style="--0:#919F9F;--1:#5D6376">// 有版本差异时可用 ble.startScan(filters)</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">setState</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">scanning</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">info</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">[BLE] scanning started</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">} </span><span style="--0:#C792EA;--1:#8844AE">catch</span><span style="--0:#D6DEEB;--1:#403F53"> (err) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">onError</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#D6DEEB;--1:#403F53">({ tag: </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">startScan</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, err });</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5F636F">/** 停止扫描 */</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">async</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">stopScan</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">try</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">await</span><span style="--0:#D6DEEB;--1:#403F53"> ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">stopBLEScan</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">off</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">BLEDeviceFind</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">); </span><span style="--0:#919F9F;--1:#5D6376">// 取消订阅</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">setState</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">idle</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">info</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">[BLE] scanning stopped</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">} </span><span style="--0:#C792EA;--1:#8844AE">catch</span><span style="--0:#D6DEEB;--1:#403F53"> (err) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">onError</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#D6DEEB;--1:#403F53">({ tag: </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">stopScan</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, err });</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5F636F">/** 连接设备 */</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">async</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">connect</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">deviceId</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">try</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">await</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">stopScan</span><span style="--0:#D6DEEB;--1:#403F53">()</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">catch</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> {});</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">setState</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">connecting</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#919F9F;--1:#5D6376">// 创建 GATT 客户端并连接</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">gatt</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> ble</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">createGattClientDevice</span><span style="--0:#D6DEEB;--1:#403F53">(deviceId);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">await</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">gatt</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">connect</span><span style="--0:#D6DEEB;--1:#403F53">();   </span><span style="--0:#919F9F;--1:#5D6376">// 有的版本是 Promise，也有 callback 形态</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">setState</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">connected</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">info</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3B61B0">[BLE] connected: </span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">deviceId</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">} </span><span style="--0:#C792EA;--1:#8844AE">catch</span><span style="--0:#D6DEEB;--1:#403F53"> (err) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">setState</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">idle</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">onError</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#D6DEEB;--1:#403F53">({ tag: </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">connect</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, err });</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5F636F">/** 读特征值 */</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">async</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">read</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">serviceUuid</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--1:#403F53"><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">charUuid</span></span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">Promise</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;</span><span style="--0:#FFCB8B;--1:#111111">Uint8Array</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">|</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">undefined</span><span style="--0:#D6DEEB;--1:#403F53">> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">try</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8844AE">!</span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">gatt</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8844AE">throw</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">Error</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">Gatt not ready</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#82AAFF;--1:#3B61B0">const</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#82AAFF;--1:#3B61B0">value</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#FFCB8B;--1:#111111">Uint8Array</span><span style="--0:#C792EA;--1:#8844AE"> = await </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">gatt</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">readCharacteristicValue</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8844AE">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#D6DEEB;--1:#403F53">serviceUuid</span><span style="--0:#C792EA;--1:#8844AE">, characteristicUuid: </span><span style="--0:#D6DEEB;--1:#403F53">charUuid</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#C792EA;--1:#8844AE">      </span></span><span style="--0:#C792EA;--1:#8844AE">} as </span><span style="--0:#C5E478;--1:#3B61B0">any</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">info</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3B61B0">[BLE] read </span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">serviceUuid</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#ECC48D;--1:#3B61B0">/</span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">charUuid</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#ECC48D;--1:#3B61B0"> -> </span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">value</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#7FDBCA;--1:#096E72">length</span><span style="--0:#E2817F;--1:#B23834"> </span><span style="--0:#C792EA;--1:#8844AE">??</span><span style="--0:#E2817F;--1:#B23834"> </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#ECC48D;--1:#3B61B0">B</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">return</span><span style="--0:#D6DEEB;--1:#403F53"> value;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">} </span><span style="--0:#C792EA;--1:#8844AE">catch</span><span style="--0:#D6DEEB;--1:#403F53"> (err) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">onError</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#D6DEEB;--1:#403F53">({ tag: </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">read</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, err });</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5F636F">/** 写特征值（支持 Write/Write NoRsp 两种策略按需配置） */</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">async</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">write</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">serviceUuid</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--1:#403F53"><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">charUuid</span></span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--1:#403F53"><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">payload</span></span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FFCB8B;--1:#111111">Uint8Array</span><span style="--1:#403F53"><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">noRsp</span><span style="--0:#D6DEEB"> </span></span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#FF6A83;--1:#A24848">false</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">try</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8844AE">!</span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">gatt</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8844AE">throw</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">Error</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">Gatt not ready</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">await</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">gatt</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">writeCharacteristicValue</span><span style="--0:#D6DEEB;--1:#403F53">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">        </span></span><span style="--0:#D6DEEB;--1:#403F53">serviceUuid,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">        </span></span><span style="--0:#D6DEEB;--1:#403F53">characteristicUuid: charUuid,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">        </span></span><span style="--0:#D6DEEB;--1:#403F53">value: payload,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">        </span></span><span style="--0:#D6DEEB;--1:#403F53">writeType: noRsp </span><span style="--0:#C792EA;--1:#8844AE">?</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">0</span><span style="--0:#D6DEEB;--1:#403F53">  </span><span style="--0:#919F9F;--1:#5D6376">// 示例：按实际枚举替换</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">} </span><span style="--0:#C792EA;--1:#8844AE">as</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">any</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">info</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3B61B0">[BLE] write </span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">serviceUuid</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#ECC48D;--1:#3B61B0">/</span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">charUuid</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#ECC48D;--1:#3B61B0"> </span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">payload</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">length</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#ECC48D;--1:#3B61B0">B</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">} </span><span style="--0:#C792EA;--1:#8844AE">catch</span><span style="--0:#D6DEEB;--1:#403F53"> (err) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">onError</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#D6DEEB;--1:#403F53">({ tag: </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">write</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, err });</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5F636F">/** 订阅通知/取消订阅 */</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">async</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">subscribe</span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">serviceUuid</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--1:#403F53"><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">charUuid</span></span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">string</span><span style="--1:#403F53"><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">enable</span></span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">boolean</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">try</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C792EA;--1:#8844AE">!</span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">gatt</span><span style="--0:#D6DEEB;--1:#403F53">) </span><span style="--0:#C792EA;--1:#8844AE">throw</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">new</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">Error</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">Gatt not ready</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">await</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">gatt</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">setCharacteristicChangeNotification</span><span style="--0:#D6DEEB;--1:#403F53">({</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">        </span></span><span style="--0:#D6DEEB;--1:#403F53">serviceUuid, characteristicUuid: charUuid, enable: enable</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">} </span><span style="--0:#C792EA;--1:#8844AE">as</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">any</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (enable) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">gatt</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">on</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">characteristicChange</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">(</span><span style="--0:#D7DBE0;--1:#403F53">res</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C5E478;--1:#3B61B0">any</span><span style="--0:#D9F5DD;--1:#111111">)</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#82AAFF;--1:#3B61B0">const</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#82AAFF;--1:#3B61B0">value</span><span style="--0:#7FDBCA;--1:#096E72">:</span><span style="--0:#C792EA;--1:#8844AE"> </span><span style="--0:#FFCB8B;--1:#111111">Uint8Array</span><span style="--0:#C792EA;--1:#8844AE"> = </span><span style="--0:#D6DEEB;--1:#403F53">res</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#FAF39F;--1:#111111">characteristic</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#7FDBCA;--1:#096E72">value</span><span style="--0:#C792EA;--1:#8844AE"> ?? </span><span style="--0:#D6DEEB;--1:#403F53">res</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#7FDBCA;--1:#096E72">value</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">onNotify</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#D6DEEB;--1:#403F53">({ service: serviceUuid, characteristic: charUuid, value });</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">        </span></span><span style="--0:#D6DEEB;--1:#403F53">});</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">} </span><span style="--0:#C792EA;--1:#8844AE">else</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">gatt</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">off</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">characteristicChange</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">info</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#ECC48D;--1:#3B61B0">[BLE] notify </span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">enable</span><span style="--0:#E2817F;--1:#B23834"> </span><span style="--0:#C792EA;--1:#8844AE">?</span><span style="--0:#E2817F;--1:#B23834"> </span><span style="--0:#D6DEEB;--1:#403F53">'</span><span style="--0:#ECC48D;--1:#984E4D">ON</span><span style="--0:#D6DEEB;--1:#403F53">'</span><span style="--0:#E2817F;--1:#B23834"> </span><span style="--0:#C792EA;--1:#8844AE">:</span><span style="--0:#E2817F;--1:#B23834"> </span><span style="--0:#D6DEEB;--1:#403F53">'</span><span style="--0:#ECC48D;--1:#984E4D">OFF</span><span style="--0:#D6DEEB;--1:#403F53">'</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#ECC48D;--1:#3B61B0"> for </span><span style="--0:#E2817F;--1:#B23834">${</span><span style="--0:#D6DEEB;--1:#403F53">charUuid</span><span style="--0:#E2817F;--1:#B23834">}</span><span style="--0:#D6DEEB;--1:#403F53">`</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">} </span><span style="--0:#C792EA;--1:#8844AE">catch</span><span style="--0:#D6DEEB;--1:#403F53"> (err) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">onError</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#D6DEEB;--1:#403F53">({ tag: </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">subscribe</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, err });</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5F636F">/** 断开并清理 */</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#C792EA;--1:#8844AE">async</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">disconnect</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">try</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#C792EA;--1:#8844AE">if</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">gatt</span><span style="--0:#D6DEEB;--1:#403F53">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#C792EA;--1:#8844AE">await</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">gatt</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">disconnect</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">gatt</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">close</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">gatt</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">undefined</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">setState</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">idle</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">      </span></span><span style="--0:#D6DEEB;--1:#403F53">console</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">info</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">[BLE] disconnected</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">} </span><span style="--0:#C792EA;--1:#8844AE">catch</span><span style="--0:#D6DEEB;--1:#403F53"> (err) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">onError</span><span style="--0:#C792EA;--1:#8844AE">?.</span><span style="--0:#D6DEEB;--1:#403F53">({ tag: </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#984E4D">disconnect</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">, err });</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#919F9F;--1:#5F636F">/** 设备列表与状态 */</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">getState</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> { </span><span style="--0:#C792EA;--1:#8844AE">return</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#7FDBCA;--1:#096E72">state</span><span style="--0:#D6DEEB;--1:#403F53">; }</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3B61B0">getDevices</span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> { </span><span style="--0:#C792EA;--1:#8844AE">return</span><span style="--0:#D6DEEB;--1:#403F53"> Array</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">from</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#096E72">this</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#FAF39F;--1:#111111">devices</span><span style="--0:#C792EA;--1:#8844AE">.</span><span style="--0:#82AAFF;--1:#3B61B0">values</span><span style="--0:#D6DEEB;--1:#403F53">()); }</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// entry/src/main/ets/utils/BleManager.etsimport ble from &#x27;@ohos.bluetooth.ble&#x27;;import { BusinessError } from &#x27;@ohos.base&#x27;;type Device = {  deviceId: string;           // 如 &#x22;XX:XX:XX:XX:XX:XX&#x22;  name?: string;  rssi?: number;  advData?: Uint8Array;};type ConnectionState = &#x27;idle&#x27; | &#x27;scanning&#x27; | &#x27;connecting&#x27; | &#x27;connected&#x27;;export class BleManager {  private static _i: BleManager;  static I() { return this._i ??= new BleManager(); }  private state: ConnectionState = &#x27;idle&#x27;;  private devices = new Map<string, Device>();  private gatt?: ble.GattClientDevice;  // 业务侧订阅  onScan?: (list: Device[]) => void;  onState?: (s: ConnectionState) => void;  onNotify?: (opt: { service: string; characteristic: string; value: Uint8Array }) => void;  onError?: (e: { tag: string; err: unknown }) => void;  private setState(s: ConnectionState) {    this.state = s;    this.onState?.(s);  }  /** 启动扫描 */  async startScan() {    try {      if (this.state === &#x27;scanning&#x27;) return;      this.devices.clear();      // 监听扫描事件（BLEDeviceFind 返回一组 ScanResult）      ble.on(&#x27;BLEDeviceFind&#x27;, (results: Array<ble.ScanResult>) => {        for (const it of results ?? []) {          const id = it.deviceId;          this.devices.set(id, {            deviceId: id,            name: it.deviceName,            rssi: it.rssi,            advData: it.advData          });        }        this.onScan?.(Array.from(this.devices.values()));      });      // 开始扫描（可按需传 filter）      await ble.startBLEScan(); // 有版本差异时可用 ble.startScan(filters)      this.setState(&#x27;scanning&#x27;);      console.info(&#x27;[BLE] scanning started&#x27;);    } catch (err) {      this.onError?.({ tag: &#x27;startScan&#x27;, err });    }  }  /** 停止扫描 */  async stopScan() {    try {      await ble.stopBLEScan();      ble.off(&#x27;BLEDeviceFind&#x27;); // 取消订阅      this.setState(&#x27;idle&#x27;);      console.info(&#x27;[BLE] scanning stopped&#x27;);    } catch (err) {      this.onError?.({ tag: &#x27;stopScan&#x27;, err });    }  }  /** 连接设备 */  async connect(deviceId: string) {    try {      await this.stopScan().catch(() => {});      this.setState(&#x27;connecting&#x27;);      // 创建 GATT 客户端并连接      this.gatt = ble.createGattClientDevice(deviceId);      await this.gatt.connect();   // 有的版本是 Promise，也有 callback 形态      this.setState(&#x27;connected&#x27;);      console.info(&#x60;[BLE] connected: ${deviceId}&#x60;);    } catch (err) {      this.setState(&#x27;idle&#x27;);      this.onError?.({ tag: &#x27;connect&#x27;, err });    }  }  /** 读特征值 */  async read(serviceUuid: string, charUuid: string): Promise<Uint8Array | undefined> {    try {      if (!this.gatt) throw new Error(&#x27;Gatt not ready&#x27;);      const value: Uint8Array = await this.gatt.readCharacteristicValue({        serviceUuid, characteristicUuid: charUuid      } as any);      console.info(&#x60;[BLE] read ${serviceUuid}/${charUuid} -> ${value?.length ?? 0}B&#x60;);      return value;    } catch (err) {      this.onError?.({ tag: &#x27;read&#x27;, err });    }  }  /** 写特征值（支持 Write/Write NoRsp 两种策略按需配置） */  async write(serviceUuid: string, charUuid: string, payload: Uint8Array, noRsp = false) {    try {      if (!this.gatt) throw new Error(&#x27;Gatt not ready&#x27;);      await this.gatt.writeCharacteristicValue({        serviceUuid,        characteristicUuid: charUuid,        value: payload,        writeType: noRsp ? 1 : 0  // 示例：按实际枚举替换      } as any);      console.info(&#x60;[BLE] write ${serviceUuid}/${charUuid} ${payload.length}B&#x60;);    } catch (err) {      this.onError?.({ tag: &#x27;write&#x27;, err });    }  }  /** 订阅通知/取消订阅 */  async subscribe(serviceUuid: string, charUuid: string, enable: boolean) {    try {      if (!this.gatt) throw new Error(&#x27;Gatt not ready&#x27;);      await this.gatt.setCharacteristicChangeNotification({        serviceUuid, characteristicUuid: charUuid, enable: enable      } as any);      if (enable) {        this.gatt.on(&#x27;characteristicChange&#x27;, (res: any) => {          const value: Uint8Array = res?.characteristic?.value ?? res?.value;          this.onNotify?.({ service: serviceUuid, characteristic: charUuid, value });        });      } else {        this.gatt.off(&#x27;characteristicChange&#x27;);      }      console.info(&#x60;[BLE] notify ${enable ? &#x27;ON&#x27; : &#x27;OFF&#x27;} for ${charUuid}&#x60;);    } catch (err) {      this.onError?.({ tag: &#x27;subscribe&#x27;, err });    }  }  /** 断开并清理 */  async disconnect() {    try {      if (this.gatt) {        await this.gatt.disconnect();        this.gatt.close?.();      }      this.gatt = undefined;      this.setState(&#x27;idle&#x27;);      console.info(&#x27;[BLE] disconnected&#x27;);    } catch (err) {      this.onError?.({ tag: &#x27;disconnect&#x27;, err });    }  }  /** 设备列表与状态 */  getState() { return this.state; }  getDevices() { return Array.from(this.devices.values()); }}"><div></div></button></div></figure></div>
<p><strong>为什么这样写？</strong></p>
<ul>
<li><code dir="auto">BLEDeviceFind</code> 事件拿扫描结果；停止扫描记得 <code dir="auto">off</code>。</li>
<li>连接走 <code dir="auto">createGattClientDevice(deviceId)</code> + <code dir="auto">connect()</code>，与官方用法一致。</li>
<li>交互走 <strong>GATT</strong>：读/写/订阅（通知）。方法名/参数在不同版本会有差异，<strong>以 API 参考为准</strong>；思路是对的：<strong>定位 service/characteristic → 读写/订阅</strong>。</li>
<li>统一错误回调与关键日志，方便线下抓包与线上埋点排障；最佳实践强调“合理使用蓝牙与前后台策略”。</li>
</ul>
<blockquote>
<p>小贴士：你的外设如果用自定义 GATT，提前把 <strong>Service/Characteristic UUID</strong> 与数据协议约定清楚，客户端开发会顺很多。</p>
</blockquote>
<hr>
<div class="sl-heading-wrapper level-h2"><h2 id="把-claude-code-用出生产力的-5-个招">把 Claude Code 用出生产力的 5 个招</h2><a class="sl-anchor-link" href="#把-claude-code-用出生产力的-5-个招"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “把 Claude Code 用出生产力的 5 个招”</span></a></div>
<p>1）<strong>让它看文档再回答</strong>：在问题里贴上 <code dir="auto">@harmony-os-docs/...</code> 路径，要求它回答带出处。
2）<strong>先要“设计稿”</strong>：让 Claude 先给「目录结构 + 状态机 + 事件流 + 关键 API 对应表」。
3）<strong>针对版本差异</strong>：要求输出“<strong>API 版本矩阵</strong>”，比如 <code dir="auto">startBLEScan</code> vs <code dir="auto">startScan</code>，哪里不确定标注“需在本机 SDK 验证”。
4）<strong>自动生成单测/桩</strong>：让它产出“模拟回调/虚拟通知”的快速用例，覆盖断线重连/权限拒绝等场景。
5）<strong>日志协议</strong>：约定 <code dir="auto">[BLE]</code> 前缀 + 关键字段，一键搜集；结合“合理蓝牙使用”最佳实践设置扫描窗口与频率。</p>
<hr>
<div class="sl-heading-wrapper level-h2"><h2 id="常见坑位清单避免踩雷">常见坑位清单（避免踩雷）</h2><a class="sl-anchor-link" href="#常见坑位清单避免踩雷"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “常见坑位清单（避免踩雷）”</span></a></div>
<ul>
<li><strong>权限</strong>：蓝牙 &#x26; 发现 &#x26; 位置三件套，按 UX 规范做前台授权提示。</li>
<li><strong>扫描拿不到设备</strong>：确认外设在广播、App 权限 OK；有版本用 <code dir="auto">startBLEScan</code>，有用 <code dir="auto">startScan(filters)</code>，事件是 <code dir="auto">BLEDeviceFind</code>。</li>
<li><strong>读写失败</strong>：多半是 UUID 不对、属性权限不匹配、或没建立通知/指示。复核 GATT 设计。</li>
<li><strong>耗电/后台</strong>：扫描要控时长与频率，遵循“合理使用蓝牙”最佳实践。</li>
</ul>
<hr>
<div class="sl-heading-wrapper level-h2"><h2 id="验收标准acceptance-criteria-对照">验收标准（Acceptance Criteria 对照）</h2><a class="sl-anchor-link" href="#验收标准acceptance-criteria-对照"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “验收标准（Acceptance Criteria 对照）”</span></a></div>
<ul>
<li>能<strong>启用 BLE</strong>、<strong>订阅事件</strong>、<strong>扫描并返回列表</strong>、<strong>连接指定设备</strong>、对指定 <strong>Service/Characteristic</strong> <strong>读/写</strong>、<strong>订阅通知</strong>、<strong>优雅断开</strong>。</li>
<li>每个操作<strong>有错误反馈与关键日志</strong>；<strong>多设备状态可管理</strong>。</li>
<li>以上均可通过 <code dir="auto">BleManager</code> 的 API 验收（示例代码已实现）。</li>
</ul>
<hr>
<div class="sl-heading-wrapper level-h2"><h2 id="进阶思路把蓝牙助手做成可复用组件">进阶思路｜把“蓝牙助手”做成可复用组件</h2><a class="sl-anchor-link" href="#进阶思路把蓝牙助手做成可复用组件"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “进阶思路｜把“蓝牙助手”做成可复用组件”</span></a></div>
<ul>
<li><strong>抽出 Hook/Store</strong>：比如 <code dir="auto">useBle()</code> 暴露状态、列表、命令函数。</li>
<li><strong>设备协议适配层</strong>：把 UUID 与解析协议写在 <code dir="auto">parsers/xxx.ts</code>。</li>
<li><strong>问题库</strong>：把抓到的错误码、边界场景沉淀成单测。</li>
<li><strong>文档化</strong>：让 Claude 生成 README + 故障排查表（FAQ）与“真机调试 checklist”。</li>
</ul>
<!-- 
---

## 参考链接（强烈建议收藏）

* ArkTS：官方入门、语言定位、风格指南。
* BLE 模块 API：`@ohos.bluetooth.ble`。
* GATT 指南：连接/读写/通知的权威说明。
* BLE 最佳实践：扫描/连接状态管理。
* 官方 BLE Codelab：含权限申请与通知回调示例。 -->
<hr>
<div class="sl-heading-wrapper level-h2"><h2 id="结语让-ai-当查手册的搭档你当架构师">结语｜让 AI 当“查手册的搭档”，你当架构师</h2><a class="sl-anchor-link" href="#结语让-ai-当查手册的搭档你当架构师"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “结语｜让 AI 当“查手册的搭档”，你当架构师”</span></a></div>
<p>把文档喂给 Claude Code，明确规则，让它<strong>按文档写 ArkTS 代码</strong>。你负责把控架构边界、状态与调试。
<strong>一个下午</strong>，一个可跑的 BLE 管理器就能起飞。你觉得呢？评论区聊聊你的设备型号和踩过的坑，我帮你补参数与调试策略。</p>
<!-- 
---

# 推荐标题（3 组，多语版 + slug）

1）**中文**：Claude Code + ArkTS：一下午做出鸿蒙 BLE 管理器

* English: Claude Code + ArkTS: Build a HarmonyOS BLE Manager in One Afternoon
* 繁體：Claude Code + ArkTS：一個下午做出鴻蒙 BLE 管理器
* 日本語：Claude Code × ArkTS：午後だけで作る HarmonyOS BLE マネージャ
* Français : Claude Code + ArkTS : créer un gestionnaire BLE HarmonyOS en un après-midi
* Español: Claude Code + ArkTS: crea un gestor BLE para HarmonyOS en una tarde
* Português: Claude Code + ArkTS: crie um gerenciador BLE para HarmonyOS em uma tarde
* **slug**：`claude-code-arkts-harmonyos-ble-manager`

2）**中文**：把文档喂给 AI：ArkTS 开发鸿蒙蓝牙 App 的正确姿势

* English: Feed the Docs to AI: The Right Way to Build HarmonyOS BLE Apps with ArkTS
* 繁體：把文件餵給 AI：用 ArkTS 開發鴻蒙藍牙 App 的正確姿勢
* 日本語：ドキュメントをAIに食べさせる：ArkTSで作るHarmonyOS BLEアプリ
* Français : Donnez la doc à l’IA : développer une app BLE HarmonyOS en ArkTS
* Español: Dale la documentación a la IA: apps BLE en HarmonyOS con ArkTS
* Português: Alimente a IA com a documentação: apps BLE no HarmonyOS com ArkTS
* **slug**：`feed-docs-to-ai-arkts-harmonyos-ble`

3）**中文**：从扫描到通知：Claude 带你写完鸿蒙 BLE 全链路

* English: From Scan to Notify: Claude Guides a Full BLE Flow on HarmonyOS
* 繁體：從掃描到通知：Claude 帶你寫完鴻蒙 BLE 全鏈路
* 日本語：スキャンから通知まで：Claudeで完成する HarmonyOS のBLEフロー
* Français : Du scan à la notification : BLE complet sur HarmonyOS avec Claude
* Español: Del escaneo a la notificación: flujo BLE completo en HarmonyOS con Claude
* Português: Do scan ao notify: fluxo BLE completo no HarmonyOS com Claude
* **slug**：`harmonyos-ble-full-flow-claude`

---

# 配图（插画风，2:1，无中文）

**封面图提示词**
“Flat illustration, wide 2:1 canvas, a developer pair-programming with an AI assistant in a code editor, HarmonyOS app wireframe on a phone, floating BLE icons (antenna, wave, chip), clean neon accent, tech vibe, soft gradients, no Chinese text.”

**关键章节配图（任选其一或都用）**

1. “Architecture diagram style, 2:1, blocks for ArkTS app → BLE Manager → GATT (services/characteristics) → Device, arrows for scan/connect/read/write/notify, minimal flat illustration, no Chinese text.”
2. “Debugging scene, 2:1, console logs and packets flowing from a phone to a sensor, tiny bell icon for notifications, tasteful gradients, no Chinese text.”
3. “Checklist board, 2:1, cards labeled Permissions / Scan / Connect / Read / Write / Notify / Logs, playful but professional illustration, no Chinese text.”

---

# 朋友圈/评论区文案（3 条）

1）“把文档塞给 Claude，ArkTS 直接起飞！一下午撸出鸿蒙 BLE 管理器，扫/连/读写/通知全活儿，真香😂”
2）“做 BLE 最怕瞎猜 API。这篇把踩坑点和代码都写明白了，抄作业就能跑，效率直接翻倍🚀”
3）“谁还在为鸿蒙蓝牙抓狂？照这套流程来，Claude 当工兵，你当指挥官，稳！”

---

需要我**把 BleManager 拆成 Hook + UI 示例页**、或**补一版外设 GATT 协议解析样例**吗？我可以直接补上。

[1]: https://developer.huawei.com/consumer/en/arkts/?utm_source=chatgpt.com "ArkTS - HUAWEI Developers"
[2]: https://developer.huawei.com/consumer/en/doc/harmonyos-references/js-apis-bluetooth-ble?utm_source=chatgpt.com "ohos.bluetooth.ble"
[3]: https://developer.huawei.com/consumer/en/doc/harmonyos-guides/gatt-development-guide-V14?utm_source=chatgpt.com "GATT Development"
[4]: https://developer.huawei.com/consumer/en/doc/harmonyos-guides/introduction-to-arkts?utm_source=chatgpt.com "Introduction-Learning ArkTS-Getting Started"
[5]: https://developer.huawei.com/consumer/en/doc/harmonyos-guides-V13/arkts-coding-style-guide-V13?utm_source=chatgpt.com "ArkTS Coding Style Guide"
[6]: https://developer.huawei.com/consumer/en/codelab/HarmonyOS-BLE/?utm_source=chatgpt.com "How to Enable Communication Between Devices Through BLE"
[7]: https://developer.huawei.com/consumer/en/doc/best-practices/bpta-bluetooth-low-energy?utm_source=chatgpt.com "Bluetooth Low Energy-Network - HUAWEI Developers"
[8]: https://www.seaxiang.com/blog/9136d7604b08488084b3560a8a116715?utm_source=chatgpt.com "harmony 鸿蒙@ohos.bluetooth.ble (Bluetooth BLE Module)"
[9]: https://developer.huawei.com/consumer/en/doc/best-practices/bpta-reasonable-bluetooth-use?utm_source=chatgpt.com "Bluetooth Resources-Proper Use of Background Hardware ..."
[10]: https://novelbits.io/bluetooth-gatt-services-characteristics/?utm_source=chatgpt.com "Bluetooth GATT: How to Design Custom Services & ..."
[11]: https://device.harmonyos.com/en/docs/apiref/doc-guides/connectivity-ble-advertising-0000001051008453?utm_source=chatgpt.com "BLE Scanning and Advertising-Bluetooth-Network ..." --> </div> <footer class="astro-dr56dw7m"> <div class="astro-sg3lsd66"><b class="astro-sg3lsd66">Tags:</b><ul class="astro-sg3lsd66"><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/claude-code/" class="astro-sg3lsd66">Claude Code</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/arkts/" class="astro-sg3lsd66">ArkTS</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/harmonyos/" class="astro-sg3lsd66">HarmonyOS</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/ble/" class="astro-sg3lsd66">BLE</a></li><li class="astro-sg3lsd66"><a href="/zh-cn/blog/tags/bluetooth-low-energy/" class="astro-sg3lsd66">Bluetooth Low Energy</a></li></ul></div> </footer> </article>  </div>    </div> <footer class="sl-flex astro-3yyafb3n"> <div class="meta sl-flex astro-3yyafb3n">   </div> <div class="pagination-links print:hidden astro-u2l5gyhi" dir="ltr">   </div>   </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html> 